# –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–≤–æ—Ä–æ–≤ –¥–ª—è –∂–∏—Ç–µ–ª–µ–π

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –¥–≤–æ—Ä–∞–º –¥–ª—è –∂–∏—Ç–µ–ª–µ–π. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ñ–∏—Ç–µ–ª—è–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞—è–≤–∫–∏ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–≤–æ—Ä–∞—Ö
- –£–ø—Ä–∞–≤–ª—è—é—â–∏–º –æ—Ç–≤–µ—á–∞—Ç—å –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–≤–æ—Ä–æ–≤
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –≥–∏–±–∫–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞

## üéØ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:
- –ñ–∏—Ç–µ–ª—å –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø **—Ç–æ–ª—å–∫–æ –∫ –¥–≤–æ—Ä—É, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –µ–≥–æ –∫–≤–∞—Ä—Ç–∏—Ä–∞**
- –≠—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ —Ü–µ–ø–æ—á–∫—É: –ö–≤–∞—Ä—Ç–∏—Ä–∞ ‚Üí –ó–¥–∞–Ω–∏–µ ‚Üí –î–≤–æ—Ä

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–≤–æ—Ä—ã:
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –∂–∏—Ç–µ–ª—é **–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–≤–æ—Ä—ã**
- –ñ–∏—Ç–µ–ª—å —Å–º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞—è–≤–∫–∏ –≤–æ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–≤–æ—Ä–∞—Ö
- –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∞–¥—Ä–µ—Å–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –¥–≤–æ—Ä—ã (–æ—Å–Ω–æ–≤–Ω—ã–µ + –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ)

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `user_yards`
```sql
CREATE TABLE user_yards (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    yard_id INTEGER REFERENCES yards(id) ON DELETE CASCADE,
    granted_by INTEGER REFERENCES users(id),  -- –ö—Ç–æ –Ω–∞–∑–Ω–∞—á–∏–ª
    comment TEXT,  -- –ü—Ä–∏—á–∏–Ω–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
    granted_at TIMESTAMP DEFAULT NOW(),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP,
    UNIQUE(user_id, yard_id)
);
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞

### –ú–æ–¥–µ–ª–∏
- `uk_management_bot/database/models/user_yard.py` - –º–æ–¥–µ–ª—å UserYard
- `User.user_yards` - relationship –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –¥–≤–æ—Ä–∞–º
- `Yard.user_yards` - –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

### –°–µ—Ä–≤–∏—Å—ã
`uk_management_bot/services/address_service.py`:
- `add_user_yard(session, user_telegram_id, yard_id, granted_by_id, comment)` - –¥–æ–±–∞–≤–∏—Ç—å –¥–≤–æ—Ä
- `remove_user_yard(session, user_telegram_id, yard_id)` - —É–¥–∞–ª–∏—Ç—å –¥–≤–æ—Ä
- `get_user_additional_yards(session, user_telegram_id)` - –ø–æ–ª—É—á–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–≤–æ—Ä—ã
- `get_user_available_yards(session, user_telegram_id)` - –ø–æ–ª—É—á–∏—Ç—å –í–°–ï –¥–≤–æ—Ä—ã (–æ—Å–Ω–æ–≤–Ω—ã–µ + –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ)

### Handlers
`uk_management_bot/handlers/user_yards_management.py`:
- `manage_user_yards_{user_id}` - –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- `add_user_yard_{user_id}` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–≤–æ—Ä–∞
- `confirm_add_yard_{user_id}_{yard_id}` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
- `remove_user_yard_{user_id}_{yard_id}` - —É–¥–∞–ª–µ–Ω–∏–µ –¥–≤–æ—Ä–∞

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∞–¥–º–∏–Ω–∫—É

### –í–∞—Ä–∏–∞–Ω—Ç 1: –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–í `admin.py` –Ω–∞–π—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É:

```python
# –í —Ñ—É–Ω–∫—Ü–∏–∏, –≥–¥–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –¥–ª—è user_detail
buttons.append([InlineKeyboardButton(
    text="üèòÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–æ—Ä–∞–º–∏",
    callback_data=f"manage_user_yards_{user_telegram_id}"
)])
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –î–æ–±–∞–≤–∏—Ç—å –≤ –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

–í –º–µ–Ω—é "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏" –¥–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç:
```python
buttons.append([InlineKeyboardButton(
    text="üèòÔ∏è –î–≤–æ—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
    callback_data="user_yards_management"
)])
```

## üìä –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–≤–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```python
from uk_management_bot.services.address_service import AddressService

# –í –∞–¥–º–∏–Ω–∫–µ, –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –¥–≤–æ—Ä–∞
success = AddressService.add_user_yard(
    session=db,
    user_telegram_id=123456789,
    yard_id=5,
    granted_by_id=admin_user.id,
    comment="–£–ø—Ä–∞–≤–ª—è—é—â–∏–π –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–≤–æ—Ä–æ–≤"
)
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–≤–æ—Ä–æ–≤
```python
# –¢–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ + –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–≤–æ—Ä—ã
yards = AddressService.get_user_available_yards(db, user_telegram_id)
# yards —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –¥–≤–æ—Ä—ã, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

## ‚úÖ –ì–æ—Ç–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- ‚úÖ –ú–æ–¥–µ–ª—å UserYard —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ Relationships –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ User –∏ Yard
- ‚úÖ –ú–µ—Ç–æ–¥—ã –≤ AddressService —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- ‚úÖ `get_user_available_yards` –æ–±–Ω–æ–≤–ª–µ–Ω (—É—á–∏—Ç—ã–≤–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–≤–æ—Ä—ã)
- ‚úÖ UI handlers —Å–æ–∑–¥–∞–Ω—ã (`user_yards_management.py`)
- ‚úÖ Router –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ `handlers/__init__.py`

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ admin.py**: –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "üèòÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–æ—Ä–∞–º–∏" –≤ –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –¥–≤–æ—Ä–æ–≤
3. **–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î**: –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã `user_yards`

## üöÄ –ó–∞–ø—É—Å–∫

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞:
1. SQLAlchemy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—É `user_yards`
2. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å—Ä–∞–∑—É –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ callbacks
3. –ñ–∏—Ç–µ–ª—å —É–≤–∏–¥–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–≤–æ—Ä—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –£–ø—Ä–∞–≤–ª—è—é—â–∏–π –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–≤–æ—Ä–æ–≤
```
–ñ–∏—Ç–µ–ª—å –ò–≤–∞–Ω–æ–≤ –ò.–ò.:
- –û—Å–Ω–æ–≤–Ω–æ–π –¥–≤–æ—Ä: –î–≤–æ—Ä –ê (—á–µ—Ä–µ–∑ –∫–≤–∞—Ä—Ç–∏—Ä—É)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ: –î–≤–æ—Ä –ë, –î–≤–æ—Ä –í (–¥–æ–±–∞–≤–ª–µ–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º)

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏ –≤–∏–¥–∏—Ç:
üèòÔ∏è –î–≤–æ—Ä –ê
üèòÔ∏è –î–≤–æ—Ä –ë
üèòÔ∏è –î–≤–æ—Ä –í
```

### –û–±—ã—á–Ω—ã–π –∂–∏—Ç–µ–ª—å
```
–ñ–∏—Ç–µ–ª—å –ü–µ—Ç—Ä–æ–≤ –ü.–ü.:
- –û—Å–Ω–æ–≤–Ω–æ–π –¥–≤–æ—Ä: –î–≤–æ—Ä –ê (—á–µ—Ä–µ–∑ –∫–≤–∞—Ä—Ç–∏—Ä—É)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–µ—Ç

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏ –≤–∏–¥–∏—Ç:
üèòÔ∏è –î–≤–æ—Ä –ê
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –î–æ–±–∞–≤–ª—è—Ç—å –¥–≤–æ—Ä—ã –º–æ–≥—É—Ç —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫—Ç–æ –∏ –∫–æ–≥–¥–∞ –¥–æ–±–∞–≤–∏–ª –¥–≤–æ—Ä
- ‚úÖ Unique constraint –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã
- ‚úÖ CASCADE DELETE –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç —Å–≤—è–∑–∏
