# üéØ UK Management Bot - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–î–∞—Ç–∞**: 15 –æ–∫—Ç—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è**: 2.0
**–°—Ç–∞—Ç—É—Å**: Production Analysis Complete

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ](#—Ç–µ–∫—É—â–µ–µ-—Å–æ—Å—Ç–æ—è–Ω–∏–µ)
2. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã](#–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–ø—Ä–æ–±–ª–µ–º—ã)
3. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–ø–æ-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)
4. [–ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Alembic](#–ø–ª–∞–Ω-–º–∏–≥—Ä–∞—Ü–∏–∏-–Ω–∞-alembic)
5. [–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏](#–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
6. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
7. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)

---

## ‚úÖ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ

1. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö** ‚úÖ
   - 20+ —Ç–∞–±–ª–∏—Ü –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã
   - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (3NF)
   - Foreign Keys –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - Cascade rules –ø—Ä–æ–¥—É–º–∞–Ω—ã

2. **–ò–Ω–¥–µ–∫—Å—ã** ‚úÖ
   - 50+ –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª—è—Ö
   - Primary Keys –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
   - Unique constraints –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
   - Foreign Key indexes –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç

3. **–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö** ‚úÖ
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ BIGINT –¥–ª—è telegram_id
   - JSON –¥–ª—è –≥–∏–±–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
   - TIMESTAMP WITH TIME ZONE –¥–ª—è –¥–∞—Ç
   - VARCHAR —Å –∞–¥–µ–∫–≤–∞—Ç–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏

4. **–ò–µ—Ä–∞—Ä—Ö–∏—è –∞–¥—Ä–µ—Å–æ–≤** ‚úÖ
   - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Yard ‚Üí Building ‚Üí Apartment
   - GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –≥–µ–æ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
   - –ú–æ–¥–µ—Ä–∞—Ü–∏—è —Å–≤—è–∑–µ–π —á–µ—Ä–µ–∑ user_apartments

5. **–°–∏—Å—Ç–µ–º–∞ —Å–º–µ–Ω** ‚úÖ
   - –ü—Ä–æ–¥—É–º–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å templates
   - AI-–æ—Ü–µ–Ω–∫–∏ –≤ shift_assignments
   - –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–¥–∞—á–∏ —Å–º–µ–Ω —Å approval workflow

### –ß—Ç–æ –Ω—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å

1. **–ù–µ—Ç Alembic –º–∏–≥—Ä–∞—Ü–∏–π** ‚ö†Ô∏è
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Base.metadata.create_all()`
   - –ù–µ—Ç –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ö–µ–º—ã
   - –°–ª–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
   - –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ deployment

2. **Sync SQLAlchemy –≤ async –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ** ‚ö†Ô∏è
   - –ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ async handlers
   - –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ deadlocks
   - –î–µ–≥—Ä–∞–¥–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

3. **N+1 –ø—Ä–æ–±–ª–µ–º—ã** ‚ö†Ô∏è
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ù–µ—Ç eager loading
   - –ó–∞–º–µ–¥–ª–µ–Ω–∏–µ –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö

4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è** üìä
   - audit_logs —Ä–∞—Å—Ç–µ—Ç –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ
   - shift_assignments –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –æ–≥—Ä–æ–º–Ω—ã–º
   - –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –±–æ–ª—å—à–∏–º —Ç–∞–±–ª–∏—Ü–∞–º

---

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. PRIMARY KEY Request.request_number (String)

**–ü—Ä–æ–±–ª–µ–º–∞**:
- `request_number` (VARCHAR) –∫–∞–∫ PRIMARY KEY
- –í—Å–µ FK —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ —Å—Ç—Ä–æ–∫—É –≤–º–µ—Å—Ç–æ INTEGER
- –°–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ JOIN –æ–ø–µ—Ä–∞—Ü–∏–π

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: ‚úÖ **–ù–ï –ú–ï–ù–Ø–¢–¨**

–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –∏–∑–º–µ–Ω–µ–Ω–∏–µ PRIMARY KEY –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ:
- –°–ª–∏—à–∫–æ–º —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ –¥–ª—è production —Å–∏—Å—Ç–µ–º—ã
- –¢—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∏ –≤—Å–µ—Ö FK
- –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- VARCHAR(10) –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–º–ø–∞–∫—Ç–µ–Ω –¥–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è**:
```
‚úÖ request_number —É–Ω–∏–∫–∞–ª–µ–Ω –∏ —Å—Ç–∞–±–∏–ª–µ–Ω
‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (YYMMDD-NNN)
‚úÖ –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä (10 –±–∞–π—Ç vs 4 –±–∞–π—Ç–∞ INT) - –ø—Ä–∏–µ–º–ª–µ–º–æ
‚úÖ –í—Å–µ FK —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ production –±–µ–∑ –ø—Ä–æ–±–ª–µ–º
```

### 2. SQLAlchemy Warning: Overlapping Relationships

**–ü—Ä–æ–±–ª–µ–º–∞**:
```python
relationship(s): 'User.executed_requests' (copies users.id to requests.executor_id).
If this is not the intention, consider if these relationships should be
linked with back_populates, or if viewonly=True should be applied
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** –≤ [user.py](uk_management_bot/database/models/user.py:57):

```python
# –ë–´–õ–û:
executed_requests = relationship("Request", foreign_keys="Request.executor_id")

# –î–û–õ–ñ–ù–û –ë–´–¢–¨:
executed_requests = relationship(
    "Request",
    foreign_keys="Request.executor_id",
    overlaps="executor"  # –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–æ
)
```

### 3. Sync DB –≤ Async Context

**–ü—Ä–æ–±–ª–µ–º–∞**: –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ë–î –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ async handlers

**–¢–µ–∫—É—â–∏–π –∫–æ–¥**:
```python
@router.message(F.text == "üìù –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É")
async def create_request(message: Message, state: FSMContext):
    db = SessionLocal()  # Sync session!
    user = db.query(User).filter(User.telegram_id == message.from_user.id).first()
    # –ë–ª–æ–∫–∏—Ä—É–µ—Ç event loop!
```

**–†–µ—à–µ–Ω–∏–µ 1: AsyncSession** (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
```python
from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession

async_engine = create_async_engine(
    "postgresql+asyncpg://uk_bot:password@postgres:5432/uk_management"
)
AsyncSessionLocal = sessionmaker(async_engine, class_=AsyncSession)

@router.message(F.text == "üìù –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É")
async def create_request(message: Message, state: FSMContext):
    async with AsyncSessionLocal() as db:
        result = await db.execute(
            select(User).where(User.telegram_id == message.from_user.id)
        )
        user = result.scalar_one_or_none()
```

**–†–µ—à–µ–Ω–∏–µ 2: run_in_executor** (–ë—ã—Å—Ç—Ä–æ–µ):
```python
import asyncio

async def get_user_sync(telegram_id: int):
    db = SessionLocal()
    try:
        return db.query(User).filter(User.telegram_id == telegram_id).first()
    finally:
        db.close()

@router.message(F.text == "üìù –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É")
async def create_request(message: Message, state: FSMContext):
    user = await asyncio.get_event_loop().run_in_executor(
        None,
        lambda: get_user_sync(message.from_user.id)
    )
```

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –í–Ω–µ–¥—Ä–∏—Ç—å Alembic –º–∏–≥—Ä–∞—Ü–∏–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î
- –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (rollback)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
- –õ—É—á—à–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ production

**–ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è** (2-3 –¥–Ω—è):

**–®–∞–≥ 1**: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Alembic
```bash
cd /path/to/project
pip install alembic asyncpg
alembic init alembic
```

**–®–∞–≥ 2**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ [alembic.ini](alembic.ini)
```ini
sqlalchemy.url = postgresql://uk_bot:password@localhost:5432/uk_management
```

**–®–∞–≥ 3**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ [alembic/env.py](alembic/env.py)
```python
from uk_management_bot.database.session import Base
import uk_management_bot.database.models  # Import all models
target_metadata = Base.metadata
```

**–®–∞–≥ 4**: –°–æ–∑–¥–∞–Ω–∏–µ initial –º–∏–≥—Ä–∞—Ü–∏–∏
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–Ω–∞–ø—à–æ—Ç —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º—ã
alembic revision --autogenerate -m "Initial schema from SQLAlchemy models"

# –ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—É—é (—Ç–∞–∫ –∫–∞–∫ –ë–î —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
alembic stamp head
```

**–®–∞–≥ 5**: –ë—É–¥—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
```bash
# –ò–∑–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å –≤ –∫–æ–¥–µ
# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "Add new field to User"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å
alembic upgrade head

# –û—Ç–∫–∞—Ç–∏—Ç—å (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
alembic downgrade -1
```

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è N+1 –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ü–ª–æ—Ö–æ–π –∫–æ–¥**:
```python
requests = db.query(Request).filter(Request.status == '–ù–æ–≤–∞—è').all()
for request in requests:
    print(request.user.first_name)  # N+1 query!
    print(request.executor.first_name)  # N+1 query!
```

**–•–æ—Ä–æ—à–∏–π –∫–æ–¥**:
```python
from sqlalchemy.orm import joinedload

requests = db.query(Request)\
    .options(
        joinedload(Request.user),
        joinedload(Request.executor),
        joinedload(Request.apartment_obj).joinedload(Apartment.building)
    )\
    .filter(Request.status == '–ù–æ–≤–∞—è')\
    .all()

for request in requests:
    print(request.user.first_name)  # –£–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!
```

**–ì–¥–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—å**:
- `handlers/requests.py` - —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫
- `handlers/shifts.py` - —Å–ø–∏—Å–æ–∫ —Å–º–µ–Ω —Å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º–∏
- `handlers/admin.py` - –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- `services/assignment_optimizer.py` - –ø–æ–∏—Å–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π

### 3. –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –≤–µ–∑–¥–µ

**–ü—Ä–æ–±–ª–µ–º–∞**: –ó–∞–ø—Ä–æ—Å—ã –±–µ–∑ LIMIT

**–ü–ª–æ—Ö–æ–π –∫–æ–¥**:
```python
all_requests = db.query(Request).all()  # –ú–æ–∂–µ—Ç –±—ã—Ç—å 10,000+ –∑–∞–ø–∏—Å–µ–π!
```

**–•–æ—Ä–æ—à–∏–π –∫–æ–¥**:
```python
def get_requests_paginated(db, page: int = 1, per_page: int = 50):
    offset = (page - 1) * per_page
    return db.query(Request)\
        .order_by(Request.created_at.desc())\
        .limit(per_page)\
        .offset(offset)\
        .all()

total = db.query(Request).count()
total_pages = (total + per_page - 1) // per_page
```

### 4. –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü

**–¢–∞–±–ª–∏—Ü—ã-–∫–∞–Ω–¥–∏–¥–∞—Ç—ã**:
- `audit_logs` - –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –º–µ—Å—è—Ü–∞–º
- `notifications` - –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –º–µ—Å—è—Ü–∞–º
- `shift_assignments` - –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –∫–≤–∞—Ä—Ç–∞–ª–∞–º

**–ü—Ä–∏–º–µ—Ä –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è audit_logs**:

```sql
-- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
ALTER TABLE audit_logs RENAME TO audit_logs_old;

CREATE TABLE audit_logs (
    id SERIAL,
    user_id INTEGER,
    action VARCHAR(100) NOT NULL,
    details JSON,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
) PARTITION BY RANGE (created_at);

-- –°–æ–∑–¥–∞—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–∏ –ø–æ –º–µ—Å—è—Ü–∞–º
CREATE TABLE audit_logs_2025_10 PARTITION OF audit_logs
    FOR VALUES FROM ('2025-10-01') TO ('2025-11-01');

CREATE TABLE audit_logs_2025_11 PARTITION OF audit_logs
    FOR VALUES FROM ('2025-11-01') TO ('2025-12-01');

-- –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
INSERT INTO audit_logs SELECT * FROM audit_logs_old;

-- –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é —Ç–∞–±–ª–∏—Ü—É
DROP TABLE audit_logs_old;
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–π**:

```python
# utils/partition_manager.py
from datetime import datetime, timedelta
from sqlalchemy import text

def create_monthly_partitions(db, table_name: str, months_ahead: int = 3):
    """–°–æ–∑–¥–∞–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏ –Ω–∞ N –º–µ—Å—è—Ü–µ–≤ –≤–ø–µ—Ä–µ–¥"""
    current_date = datetime.now()

    for i in range(months_ahead):
        month_start = (current_date + timedelta(days=30*i)).replace(day=1)
        month_end = (month_start + timedelta(days=32)).replace(day=1)

        partition_name = f"{table_name}_{month_start.strftime('%Y_%m')}"

        sql = f"""
        CREATE TABLE IF NOT EXISTS {partition_name} PARTITION OF {table_name}
        FOR VALUES FROM ('{month_start}') TO ('{month_end}');
        """

        db.execute(text(sql))
        db.commit()
```

### 5. –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

**–°–æ–∑–¥–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ views**:

```sql
-- 1. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
CREATE MATERIALIZED VIEW mv_executor_stats AS
SELECT
    u.id as executor_id,
    u.first_name,
    u.last_name,
    COUNT(DISTINCT r.request_number) as total_requests,
    COUNT(DISTINCT CASE WHEN r.status = '–í—ã–ø–æ–ª–Ω–µ–Ω–∞' THEN r.request_number END) as completed_requests,
    AVG(EXTRACT(EPOCH FROM (r.completed_at - r.created_at))/3600) as avg_completion_hours,
    AVG(rat.rating) as avg_rating
FROM users u
LEFT JOIN requests r ON u.id = r.executor_id
LEFT JOIN ratings rat ON r.request_number = rat.request_number
WHERE u.active_role = 'executor'
GROUP BY u.id, u.first_name, u.last_name;

CREATE UNIQUE INDEX ON mv_executor_stats (executor_id);

-- –û–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
CREATE OR REPLACE FUNCTION refresh_executor_stats()
RETURNS void AS $$
BEGIN
    REFRESH MATERIALIZED VIEW CONCURRENTLY mv_executor_stats;
END;
$$ LANGUAGE plpgsql;

-- –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ pg_cron –∏–ª–∏ APScheduler
```

### 6. Connection Pooling –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
```python
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –¥–ª—è Production**:

```python
from sqlalchemy import create_engine
from sqlalchemy.pool import QueuePool

engine = create_engine(
    DATABASE_URL,
    poolclass=QueuePool,
    pool_size=30,           # –£–≤–µ–ª–∏—á–∏—Ç—å –¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
    max_overflow=20,        # –ë—É—Ñ–µ—Ä –¥–ª—è –ø–∏–∫–æ–≤—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫
    pool_timeout=30,        # –ñ–¥–∞—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ 30 —Å–µ–∫
    pool_recycle=3600,      # –ü–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫–∞–∂–¥—ã–π —á–∞—Å
    pool_pre_ping=True,     # –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
    echo_pool=False,        # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å pool –≤ DEBUG —Ä–µ–∂–∏–º–µ
)
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 1. Row Level Security (RLS)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í–Ω–µ–¥—Ä–∏—Ç—å RLS –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü

```sql
-- –í–∫–ª—é—á–∏—Ç—å RLS –¥–ª—è requests
ALTER TABLE requests ENABLE ROW LEVEL SECURITY;

-- –ü–æ–ª–∏—Ç–∏–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞—è–≤–∫–∏
CREATE POLICY requests_user_policy ON requests
    FOR SELECT
    USING (user_id = current_setting('app.user_id')::integer);

-- –ü–æ–ª–∏—Ç–∏–∫–∞: –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –≤–∏–¥–∏—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –µ–º—É –∑–∞—è–≤–∫–∏
CREATE POLICY requests_executor_policy ON requests
    FOR SELECT
    USING (executor_id = current_setting('app.user_id')::integer);

-- –ü–æ–ª–∏—Ç–∏–∫–∞: –º–µ–Ω–µ–¥–∂–µ—Ä—ã –≤–∏–¥—è—Ç –≤—Å—ë
CREATE POLICY requests_manager_policy ON requests
    FOR ALL
    USING (
        EXISTS (
            SELECT 1 FROM users
            WHERE id = current_setting('app.user_id')::integer
            AND active_role = 'manager'
        )
    );
```

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ –∫–æ–¥–µ**:
```python
def set_user_context(db, user_id: int):
    db.execute(text(f"SET app.user_id = {user_id}"))
```

### 2. –ê—É–¥–∏—Ç –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–°–æ–∑–¥–∞—Ç—å trigger –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞—É–¥–∏—Ç–∞**:

```sql
-- –§—É–Ω–∫—Ü–∏—è –∞—É–¥–∏—Ç–∞
CREATE OR REPLACE FUNCTION audit_trigger_function()
RETURNS TRIGGER AS $$
BEGIN
    IF TG_OP = 'INSERT' THEN
        INSERT INTO audit_logs (action, details)
        VALUES (
            TG_TABLE_NAME || '_INSERT',
            row_to_json(NEW)
        );
        RETURN NEW;
    ELSIF TG_OP = 'UPDATE' THEN
        INSERT INTO audit_logs (action, details)
        VALUES (
            TG_TABLE_NAME || '_UPDATE',
            json_build_object(
                'old', row_to_json(OLD),
                'new', row_to_json(NEW)
            )
        );
        RETURN NEW;
    ELSIF TG_OP = 'DELETE' THEN
        INSERT INTO audit_logs (action, details)
        VALUES (
            TG_TABLE_NAME || '_DELETE',
            row_to_json(OLD)
        );
        RETURN OLD;
    END IF;
END;
$$ LANGUAGE plpgsql;

-- –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º —Ç–∞–±–ª–∏—Ü–∞–º
CREATE TRIGGER audit_requests
AFTER INSERT OR UPDATE OR DELETE ON requests
FOR EACH ROW EXECUTE FUNCTION audit_trigger_function();

CREATE TRIGGER audit_users
AFTER INSERT OR UPDATE OR DELETE ON users
FOR EACH ROW EXECUTE FUNCTION audit_trigger_function();
```

### 3. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å pgcrypto –¥–ª—è –ø–∞—Å–ø–æ—Ä—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**:

```sql
CREATE EXTENSION IF NOT EXISTS pgcrypto;

-- –§—É–Ω–∫—Ü–∏—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
CREATE OR REPLACE FUNCTION encrypt_sensitive(value TEXT)
RETURNS BYTEA AS $$
BEGIN
    RETURN pgp_sym_encrypt(value, current_setting('app.encryption_key'));
END;
$$ LANGUAGE plpgsql;

-- –§—É–Ω–∫—Ü–∏—è –¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
CREATE OR REPLACE FUNCTION decrypt_sensitive(encrypted BYTEA)
RETURNS TEXT AS $$
BEGIN
    RETURN pgp_sym_decrypt(encrypted, current_setting('app.encryption_key'));
END;
$$ LANGUAGE plpgsql;

-- –ò–∑–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å User
ALTER TABLE users ALTER COLUMN passport_series TYPE BYTEA
    USING pgp_sym_encrypt(passport_series, 'encryption_key');

ALTER TABLE users ALTER COLUMN passport_number TYPE BYTEA
    USING pgp_sym_encrypt(passport_number, 'encryption_key');
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### 1. –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**:

```python
# utils/db_monitoring.py
from prometheus_client import Counter, Histogram, Gauge
import time
from functools import wraps

# –ú–µ—Ç—Ä–∏–∫–∏
db_query_duration = Histogram(
    'db_query_duration_seconds',
    'Database query duration',
    ['query_type', 'table']
)

db_query_total = Counter(
    'db_query_total',
    'Total database queries',
    ['query_type', 'table', 'status']
)

db_connection_pool_size = Gauge(
    'db_connection_pool_size',
    'Current connection pool size'
)

def monitor_query(query_type: str, table: str):
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∑–∞–ø—Ä–æ—Å–æ–≤"""
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            start_time = time.time()
            status = 'success'

            try:
                result = func(*args, **kwargs)
                return result
            except Exception as e:
                status = 'error'
                raise
            finally:
                duration = time.time() - start_time
                db_query_duration.labels(
                    query_type=query_type,
                    table=table
                ).observe(duration)

                db_query_total.labels(
                    query_type=query_type,
                    table=table,
                    status=status
                ).inc()

        return wrapper
    return decorator

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
@monitor_query('SELECT', 'requests')
def get_active_requests(db):
    return db.query(Request).filter(
        Request.status.in_(['–ù–æ–≤–∞—è', '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ'])
    ).all()
```

### 2. Slow Query Log

**–ù–∞—Å—Ç—Ä–æ–∏—Ç—å PostgreSQL –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**:

```sql
-- –í postgresql.conf
ALTER SYSTEM SET log_min_duration_statement = 1000;  -- 1 —Å–µ–∫—É–Ω–¥–∞
ALTER SYSTEM SET log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h ';
ALTER SYSTEM SET log_statement = 'ddl';

-- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL
SELECT pg_reload_conf();
```

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –ë–î

```python
# utils/db_health_check.py
from sqlalchemy import text
import logging

logger = logging.getLogger(__name__)

async def check_database_health(db) -> dict:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""

    health = {
        'status': 'healthy',
        'checks': {}
    }

    # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    try:
        db.execute(text("SELECT 1"))
        health['checks']['connection'] = 'ok'
    except Exception as e:
        health['status'] = 'unhealthy'
        health['checks']['connection'] = f'failed: {str(e)}'

    # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –ë–î
    try:
        result = db.execute(text(
            "SELECT pg_size_pretty(pg_database_size(current_database()))"
        ))
        size = result.scalar()
        health['checks']['database_size'] = size
    except Exception as e:
        logger.error(f"Failed to get database size: {e}")

    # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
    try:
        result = db.execute(text("""
            SELECT count(*) FROM pg_stat_activity
            WHERE datname = current_database()
        """))
        connections = result.scalar()
        health['checks']['active_connections'] = connections

        if connections > 80:
            health['status'] = 'degraded'
            health['checks']['connection_warning'] = 'High connection count'
    except Exception as e:
        logger.error(f"Failed to get connection count: {e}")

    # 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    try:
        result = db.execute(text("SELECT pg_is_in_recovery()"))
        is_replica = result.scalar()
        health['checks']['replication'] = 'replica' if is_replica else 'primary'
    except Exception as e:
        logger.error(f"Failed to check replication: {e}")

    # 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    try:
        result = db.execute(text("""
            SELECT schemaname, tablename, indexname
            FROM pg_stat_user_indexes
            WHERE idx_scan = 0 AND idx_tup_read = 0
            LIMIT 5
        """))
        unused_indexes = [dict(row) for row in result]
        if unused_indexes:
            health['checks']['unused_indexes'] = unused_indexes
    except Exception as e:
        logger.error(f"Failed to check unused indexes: {e}")

    return health
```

---

## üìÖ –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π (–ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è)

### –ù–µ–¥–µ–ª—è 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å overlapping relationships warning –≤ User –º–æ–¥–µ–ª–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å missing indexes –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å connection pool –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ
- [ ] –í–∫–ª—é—á–∏—Ç—å slow query log

### –ù–µ–¥–µ–ª—è 2: Alembic –º–∏–≥—Ä–∞—Ü–∏–∏
- [ ] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Alembic
- [ ] –°–æ–∑–¥–∞—Ç—å initial –º–∏–≥—Ä–∞—Ü–∏—é
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ dev –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å

### –ù–µ–¥–µ–ª—è 3: Async SQLAlchemy
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å asyncpg
- [ ] –°–æ–∑–¥–∞—Ç—å AsyncEngine
- [ ] –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å 5 —Å–∞–º—ã—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö handlers
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ù–µ–¥–µ–ª—è 4: N+1 –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ N+1 –ø—Ä–æ–±–ª–µ–º—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å joinedload –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –≤–µ–∑–¥–µ
- [ ] –ó–∞–º–µ—Ä–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ú–µ—Å—è—Ü 2: –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤ÔøΩÔøΩ—Ç—å audit_logs
- [ ] –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å notifications
- [ ] –°–æ–∑–¥–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∫—É –¥–ª—è –ø–∞—Ä—Ç–∏—Ü–∏–π
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞—Ä—Ö–∏–≤–∞—Ü–∏—é —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –ú–µ—Å—è—Ü 3: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] –í–Ω–µ–¥—Ä–∏—Ç—å RLS
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Prometheus –º–µ—Ç—Ä–∏–∫–∏
- [ ] –°–æ–∑–¥–∞—Ç—å Grafana –¥–∞—à–±–æ—Ä–¥

---

## üéì –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –¢–µ–∫—É—â–∞—è –æ—Ü–µ–Ω–∫–∞: 9.0/10

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã**:
- ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∏ FK
- ‚úÖ –•–æ—Ä–æ—à–∏–µ –∏–Ω–¥–µ–∫—Å—ã
- ‚úÖ –ü—Ä–æ–¥—É–º–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–ß—Ç–æ —É–ª—É—á—à–∏—Ç—å**:
- ‚ö†Ô∏è –í–Ω–µ–¥—Ä–∏—Ç—å Alembic (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è production)
- ‚ö†Ô∏è –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ AsyncSQLAlchemy
- ‚ö†Ô∏è –£—Å—Ç—Ä–∞–Ω–∏—Ç—å N+1 –ø—Ä–æ–±–ª–µ–º—ã
- üìä –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü–æ—Å–ª–µ –≤—Å–µ—Ö —É–ª—É—á—à–µ–Ω–∏–π: 10/10

---

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω**: 15 –æ–∫—Ç—è–±—Ä—è 2025
**–ê–≤—Ç–æ—Ä**: Claude Sonnet 4.5
**–í–µ—Ä—Å–∏—è**: 2.0
**–°—Ç–∞—Ç—É—Å**: Ready for Implementation
