# üè¢ TASK 15: –°–ò–°–¢–ï–ú–ê –ï–î–ò–ù–û–ì–û –°–ü–†–ê–í–û–ß–ù–ò–ö–ê –ê–î–†–ï–°–û–í

**–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞**: 12 –æ–∫—Ç—è–±—Ä—è 2025
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 12 –æ–∫—Ç—è–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: ü•á –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: Level 4 (Enterprise Development)
**–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è**: 41-53 —á–∞—Å–∞ (5-7 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π)
**–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è**: ~8 —á–∞—Å–æ–≤ (1 —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å) ‚ö°

---

## üìã –ö–†–ê–¢–ö–û–ï –û–ü–ò–°–ê–ù–ò–ï

–°–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –∞–¥—Ä–µ—Å–æ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª—è—é—â–µ–π –∫–æ–º–ø–∞–Ω–∏–∏ —Å –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π **–î–≤–æ—Ä ‚Üí –î–æ–º ‚Üí –ö–≤–∞—Ä—Ç–∏—Ä–∞ ‚Üí –ñ–∏—Ç–µ–ª—å** –∏ —Å–∏—Å—Ç–µ–º–æ–π –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π –∫–≤–∞—Ä—Ç–∏—Ä.

### üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- ‚úÖ –ê–¥–º–∏–Ω —Å–æ–∑–¥–∞–µ—Ç —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∞–¥—Ä–µ—Å–æ–≤ (–¥–≤–æ—Ä—ã, –¥–æ–º–∞, –∫–≤–∞—Ä—Ç–∏—Ä—ã)
- ‚úÖ –ñ–∏—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∫–≤–∞—Ä—Ç–∏—Ä—É –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞
- ‚úÖ **–ú–µ–Ω–µ–¥–∂–µ—Ä/–∞–¥–º–∏–Ω –º–æ–¥–µ—Ä–∏—Ä—É–µ—Ç –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã**
- ‚úÖ –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏ –¥–æ–º –∏ –¥–≤–æ—Ä –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è GeoOptimizer
- ‚úÖ –ß–∏—Å—Ç—ã–π —Å—Ç–∞—Ä—Ç –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏ legacy –¥–∞–Ω–Ω—ã—Ö

---

## üéØ –¶–ï–õ–ò –ò –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ë–∏–∑–Ω–µ—Å-—Ü–µ–ª–∏:
1. **–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–∞–Ω–Ω—ã—Ö**: –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –∞–¥—Ä–µ—Å–æ–≤
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ú–æ–¥–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ñ–µ–π–∫–æ–≤—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
3. **UX**: –í—ã–±–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞ –±—ã—Å—Ç—Ä–µ–µ —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞
4. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞**: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–≤–æ—Ä–∞–º/–¥–æ–º–∞–º, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–∞–±–æ—Ç–µ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –£–ö

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- 4 –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –ë–î: Yard, Building, Apartment, UserApartment
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏: User, Request
- 3 –Ω–æ–≤—ã—Ö handler –º–æ–¥—É–ª—è
- AddressService —Å 20+ –º–µ—Ç–æ–¥–∞–º–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GeoOptimizer —á–µ—Ä–µ–∑ GPS
- –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

---

## üîê WORKFLOW

### 1Ô∏è‚É£ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∂–∏—Ç–µ–ª—è:
```
–ñ–∏—Ç–µ–ª—å ‚Üí /join <token> ‚Üí
–í–≤–æ–¥ –§–ò–û ‚Üí
–í—ã–±–æ—Ä –¥–æ–º–∞ –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ ‚Üí
–í—ã–±–æ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã ‚Üí
–°—Ç–∞—Ç—É—Å: pending ‚Üí
–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞
```

### 2Ô∏è‚É£ –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º:
```
–ê–¥–º–∏–Ω ‚Üí –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–æ–∫ pending ‚Üí
–í–∏–¥–∏—Ç –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—É—é –∫–≤–∞—Ä—Ç–∏—Ä—É ‚Üí
[‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å] [üîÑ –ò–∑–º–µ–Ω–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É] [‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å] ‚Üí
–ö–≤–∞—Ä—Ç–∏—Ä–∞ –∑–∞–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è –∑–∞ –∂–∏—Ç–µ–ª–µ–º ‚Üí
–°—Ç–∞—Ç—É—Å: approved ‚Üí
–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∂–∏—Ç–µ–ª—è
```

### 3Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏:
```
–ñ–∏—Ç–µ–ª—å ‚Üí –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É ‚Üí
–í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí
–í—ã–±–æ—Ä –∏–∑ —Å–≤–æ–∏—Ö –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö –∫–≤–∞—Ä—Ç–∏—Ä ‚Üí
–î–æ–º –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Üí
–î–≤–æ—Ä –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Üí
–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã ‚Üí
–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞
```

---

## üìä –î–ï–¢–ê–õ–¨–ù–´–ô –ü–õ–ê–ù –ó–ê–î–ê–ß

### üì¶ –≠–¢–ê–ü 1: –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (4-5 —á–∞—Å–æ–≤)

#### 1.1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ (3 —á–∞—Å–∞)

**–ó–∞–¥–∞—á–∞ 1.1.1: –ú–æ–¥–µ–ª—å Yard (–î–≤–æ—Ä)** ‚è±Ô∏è 30 –º–∏–Ω
- [x] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `uk_management_bot/database/models/yard.py`
- [ ] –ü–æ–ª—è: id, name, description, gps_latitude, gps_longitude, is_active
- [ ] –°–≤—è–∑–∏: buildings (1:N), creator
- [ ] –ú–µ—Ç–æ–¥—ã: buildings_count, active_buildings_count
- [ ] –ò–Ω–¥–µ–∫—Å—ã: name (unique), is_active

**–ó–∞–¥–∞—á–∞ 1.1.2: –ú–æ–¥–µ–ª—å Building (–î–æ–º)** ‚è±Ô∏è 40 –º–∏–Ω
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `uk_management_bot/database/models/building.py`
- [ ] –ü–æ–ª—è: id, address, yard_id, gps_latitude, gps_longitude, entrance_count, floor_count, is_active
- [ ] –°–≤—è–∑–∏: yard (N:1), apartments (1:N), creator
- [ ] –ú–µ—Ç–æ–¥—ã: apartments_count, residents_count
- [ ] –ò–Ω–¥–µ–∫—Å—ã: yard_id, is_active

**–ó–∞–¥–∞—á–∞ 1.1.3: –ú–æ–¥–µ–ª—å Apartment (–ö–≤–∞—Ä—Ç–∏—Ä–∞)** ‚è±Ô∏è 40 –º–∏–Ω
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `uk_management_bot/database/models/apartment.py`
- [ ] –ü–æ–ª—è: id, number, floor, entrance, building_id, rooms_count, area, is_active
- [ ] –°–≤—è–∑–∏: building (N:1), residents (UserApartment)
- [ ] Constraint: UniqueConstraint(building_id, number)
- [ ] –ú–µ—Ç–æ–¥—ã: full_address, residents_count
- [ ] –ò–Ω–¥–µ–∫—Å—ã: building_id, is_active

**–ó–∞–¥–∞—á–∞ 1.1.4: –ú–æ–¥–µ–ª—å UserApartment (–°–≤—è–∑—å —Å –º–æ–¥–µ—Ä–∞—Ü–∏–µ–π)** ‚è±Ô∏è 50 –º–∏–Ω
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `uk_management_bot/database/models/user_apartment.py`
- [ ] –ü–æ–ª—è: id, user_id, apartment_id, status (pending/approved/rejected)
- [ ] –ü–æ–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏: requested_at, reviewed_at, reviewed_by, review_comment
- [ ] –ü–æ–ª–µ: is_primary (–æ—Å–Ω–æ–≤–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞)
- [ ] –°–≤—è–∑–∏: user (N:1), apartment (N:1), reviewer (N:1)
- [ ] Constraint: UniqueConstraint(user_id, apartment_id)
- [ ] –ò–Ω–¥–µ–∫—Å—ã: user_id, apartment_id, status

**–ó–∞–¥–∞—á–∞ 1.1.5: –û–±–Ω–æ–≤–∏—Ç—å __init__.py** ‚è±Ô∏è 10 –º–∏–Ω
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –Ω–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π –≤ `uk_management_bot/database/models/__init__.py`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏–º–ø–æ—Ä—Ç–æ–≤

#### 1.2. –û—á–∏—Å—Ç–∏—Ç—å –∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ (1 —á–∞—Å)

**–ó–∞–¥–∞—á–∞ 1.2.1: –û—á–∏—Å—Ç–∏—Ç—å –º–æ–¥–µ–ª—å User** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] –£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–æ–ª—è:
  - [ ] `address` (Text) - legacy
  - [ ] `home_address` (Text)
  - [ ] `apartment_address` (Text)
  - [ ] `yard_address` (Text)
  - [ ] `address_type` (String)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø–æ–ª–µ:
  - [ ] `requested_apartment_id` (Integer, FK apartments.id)
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–≤—è–∑—å:
  - [ ] `apartments = relationship("UserApartment")`
  - [ ] `requested_apartment = relationship("Apartment")`

**–ó–∞–¥–∞—á–∞ 1.2.2: –û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª—å Request** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ: `apartment_id` (Integer, FK apartments.id, nullable=True)
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–≤—è–∑—å: `apartment = relationship("Apartment")`
- [ ] –°–¥–µ–ª–∞—Ç—å `address` nullable=True (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
- [ ] –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å `apartment` ‚Üí `apartment_number_legacy` (String, –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- [ ] –î–æ–±–∞–≤–∏—Ç—å property `full_address` –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑ apartment

#### 1.3. –°–æ–∑–¥–∞—Ç—å Alembic –º–∏–≥—Ä–∞—Ü–∏—é (30-40 –º–∏–Ω)

**–ó–∞–¥–∞—á–∞ 1.3.1: –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏** ‚è±Ô∏è 40 –º–∏–Ω
- [ ] –í—ã–ø–æ–ª–Ω–∏—Ç—å: `alembic revision -m "add_address_directory_system"`
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å upgrade():
  - [ ] DROP COLUMN users.address
  - [ ] DROP COLUMN users.home_address
  - [ ] DROP COLUMN users.apartment_address
  - [ ] DROP COLUMN users.yard_address
  - [ ] DROP COLUMN users.address_type
  - [ ] ADD COLUMN users.requested_apartment_id
  - [ ] CREATE TABLE yards
  - [ ] CREATE TABLE buildings
  - [ ] CREATE TABLE apartments
  - [ ] CREATE TABLE user_apartments
  - [ ] ADD COLUMN requests.apartment_id
  - [ ] ALTER requests.address SET nullable=True
  - [ ] CREATE INDEXES
  - [ ] CREATE FOREIGN KEYS
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å downgrade() (–æ–±—Ä–∞—Ç–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

---

### üîß –≠–¢–ê–ü 2: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (7-9 —á–∞—Å–æ–≤)

#### 2.1. –°–æ–∑–¥–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π handler (2 —á–∞—Å–∞)

**–ó–∞–¥–∞—á–∞ 2.1.1: –°–æ–∑–¥–∞—Ç—å handlers/address_directory.py** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] –°–æ–∑–¥–∞—Ç—å Router –¥–ª—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞
- [ ] –°–æ–∑–¥–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏:
  - [ ] –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–æ—Ä–∞–º–∏
  - [ ] –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–º–∞–º–∏
  - [ ] –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä–∞–º–∏
  - [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  - [ ] –ù–∞–∑–∞–¥
- [ ] –î–æ–±–∞–≤–∏—Ç—å middleware (auth, role check –¥–ª—è manager/admin)

**–ó–∞–¥–∞—á–∞ 2.1.2: Handler —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `show_statistics()` - –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–∑ AddressService
- [ ] –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å:
  - [ ] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–≤–æ—Ä–æ–≤ (–∞–∫—Ç–∏–≤–Ω—ã—Ö/–≤—Å–µ–≥–æ)
  - [ ] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–º–æ–≤ (–∞–∫—Ç–∏–≤–Ω—ã—Ö/–≤—Å–µ–≥–æ)
  - [ ] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–≤–∞—Ä—Ç–∏—Ä (–∞–∫—Ç–∏–≤–Ω—ã—Ö/–≤—Å–µ–≥–æ)
  - [ ] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏–ª—å—Ü–æ–≤ (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ/–Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏)
  - [ ] –ó–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –ø–æ –¥–≤–æ—Ä–∞–º (%)

**–ó–∞–¥–∞—á–∞ 2.1.3: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ main router** ‚è±Ô∏è 20 –º–∏–Ω
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç –≤ `uk_management_bot/handlers/__init__.py`
- [ ] –í–∫–ª—é—á–∏—Ç—å router –≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ –∞–¥–º–∏–Ω—Å–∫–æ–µ –º–µ–Ω—é

#### 2.2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–æ—Ä–∞–º–∏ (1.5 —á–∞—Å–∞)

**–ó–∞–¥–∞—á–∞ 2.2.1: –°–ø–∏—Å–æ–∫ –¥–≤–æ—Ä–æ–≤** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `show_yards_list()` - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–≤–æ—Ä—ã —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- [ ] –§–æ—Ä–º–∞—Ç: "üå≥ –î–≤–æ—Ä ‚Ññ1 (5 –¥–æ–º–æ–≤) [–ê–∫—Ç–∏–≤–µ–Ω]"
- [ ] –ö–Ω–æ–ø–∫–∏: [–°–æ–∑–¥–∞—Ç—å –¥–≤–æ—Ä] [–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å] [–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å]

**–ó–∞–¥–∞—á–∞ 2.2.2: –°–æ–∑–¥–∞–Ω–∏–µ –¥–≤–æ—Ä–∞** ‚è±Ô∏è 40 –º–∏–Ω
- [ ] `create_yard_start()` - –Ω–∞—á–∞–ª–æ FSM
- [ ] `handle_yard_name()` - –≤–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è
- [ ] `handle_yard_description()` - –≤–≤–æ–¥ –æ–ø–∏—Å–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] `handle_yard_gps()` - –≤–≤–æ–¥ GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] `handle_yard_confirmation()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏—è

**–ó–∞–¥–∞—á–∞ 2.2.3: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `edit_yard()` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ FSM
- [ ] `deactivate_yard()` - –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–µ–ª—å–∑—è –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–≤–æ—Ä —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –¥–æ–º–∞–º–∏

#### 2.3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–º–∞–º–∏ (2 —á–∞—Å–∞)

**–ó–∞–¥–∞—á–∞ 2.3.1: –°–ø–∏—Å–æ–∫ –¥–æ–º–æ–≤** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `show_buildings_list()` - —Å–ø–∏—Å–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ –¥–≤–æ—Ä—É
- [ ] –§–æ—Ä–º–∞—Ç: "üè¢ —É–ª. –õ–µ–Ω–∏–Ω–∞, 5 (–î–≤–æ—Ä ‚Ññ1, 12 –∫–≤–∞—Ä—Ç–∏—Ä)"
- [ ] –ö–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –¥–≤–æ—Ä—É
- [ ] –ü–∞–≥–∏–Ω–∞—Ü–∏—è

**–ó–∞–¥–∞—á–∞ 2.3.2: –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–º–∞** ‚è±Ô∏è 60 –º–∏–Ω
- [ ] `create_building_start()` - –≤—ã–±–æ—Ä –¥–≤–æ—Ä–∞
- [ ] `handle_building_yard()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ yard_id
- [ ] `handle_building_address()` - –≤–≤–æ–¥ –∞–¥—Ä–µ—Å–∞
- [ ] `handle_building_gps()` - GPS (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] `handle_building_details()` - –ø–æ–¥—ä–µ–∑–¥—ã, —ç—Ç–∞–∂–∏
- [ ] `handle_building_confirmation()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞

**–ó–∞–¥–∞—á–∞ 2.3.3: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `edit_building()` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] `deactivate_building()` - –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–µ–ª—å–∑—è –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–æ–º —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∫–≤–∞—Ä—Ç–∏—Ä–∞–º–∏

#### 2.4. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä–∞–º–∏ (2.5 —á–∞—Å–∞)

**–ó–∞–¥–∞—á–∞ 2.4.1: –°–ø–∏—Å–æ–∫ –∫–≤–∞—Ä—Ç–∏—Ä** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `show_apartments_list()` - —Å–ø–∏—Å–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ –¥–æ–º—É
- [ ] –§–æ—Ä–º–∞—Ç: "üè† –ö–≤. 12 (–ø–æ–¥—ä–µ–∑–¥ 1, —ç—Ç–∞–∂ 3) - –ò–≤–∞–Ω–æ–≤ –ò.–ò."
- [ ] –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–Ω—è—Ç–æ—Å—Ç—å
- [ ] –ü–∞–≥–∏–Ω–∞—Ü–∏—è, —Ñ–∏–ª—å—Ç—Ä—ã

**–ó–∞–¥–∞—á–∞ 2.4.2: –°–æ–∑–¥–∞–Ω–∏–µ –æ–¥–Ω–æ–π –∫–≤–∞—Ä—Ç–∏—Ä—ã** ‚è±Ô∏è 40 –º–∏–Ω
- [ ] `create_apartment_start()` - –≤—ã–±–æ—Ä –¥–æ–º–∞
- [ ] `handle_apartment_building()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ building_id
- [ ] `handle_apartment_number()` - –≤–≤–æ–¥ –Ω–æ–º–µ—Ä–∞
- [ ] `handle_apartment_floor()` - –≤–≤–æ–¥ —ç—Ç–∞–∂–∞
- [ ] `handle_apartment_entrance()` - –≤–≤–æ–¥ –ø–æ–¥—ä–µ–∑–¥–∞
- [ ] `handle_apartment_confirmation()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–æ–º–µ—Ä–∞ –≤ –¥–æ–º–µ

**–ó–∞–¥–∞—á–∞ 2.4.3: –ú–∞—Å—Å–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä** ‚è±Ô∏è 60 –º–∏–Ω
- [ ] `bulk_create_apartments_start()` - –≤—ã–±–æ—Ä –¥–æ–º–∞
- [ ] `handle_bulk_building()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–º–∞
- [ ] `handle_bulk_range()` - –≤–≤–æ–¥ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ (–Ω–∞–ø—Ä. "1-50")
- [ ] `handle_bulk_floor()` - —ç—Ç–∞–∂ –¥–ª—è –≤—Å–µ—Ö
- [ ] `handle_bulk_entrance()` - –ø–æ–¥—ä–µ–∑–¥ –¥–ª—è –≤—Å–µ—Ö
- [ ] `handle_bulk_confirmation()` - preview —Å–ø–∏—Å–∫–∞
- [ ] `handle_bulk_execute()` - –º–∞—Å—Å–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≤ –ë–î
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

**–ó–∞–¥–∞—á–∞ 2.4.4: –ü—Ä–æ—Å–º–æ—Ç—Ä –∂–∏–ª—å—Ü–æ–≤ –∫–≤–∞—Ä—Ç–∏—Ä—ã** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `show_apartment_residents()` - —Å–ø–∏—Å–æ–∫ –∂–∏–ª—å—Ü–æ–≤
- [ ] –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å (approved/pending)
- [ ] –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é –∫–≤–∞—Ä—Ç–∏—Ä—É (is_primary)
- [ ] –ö–Ω–æ–ø–∫–∞: [–£–¥–∞–ª–∏—Ç—å –∂–∏–ª—å—Ü–∞]

#### 2.5. FSM States –∏ Keyboards (1 —á–∞—Å)

**–ó–∞–¥–∞—á–∞ 2.5.1: –°–æ–∑–¥–∞—Ç—å states/address_directory.py** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `YardManagementStates` (entering_name, entering_description, entering_gps)
- [ ] `BuildingManagementStates` (selecting_yard, entering_address, entering_gps, entering_details)
- [ ] `ApartmentManagementStates` (selecting_building, entering_number, entering_floor, entering_entrance)
- [ ] `BulkApartmentStates` (selecting_building, entering_range, entering_floor, entering_entrance, confirming)

**–ó–∞–¥–∞—á–∞ 2.5.2: –°–æ–∑–¥–∞—Ç—å keyboards/address_directory.py** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `get_directory_main_keyboard()` - –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- [ ] `get_yards_list_keyboard(yards, page)` - —Å–ø–∏—Å–æ–∫ –¥–≤–æ—Ä–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- [ ] `get_yard_actions_keyboard(yard_id)` - –¥–µ–π—Å—Ç–≤–∏—è —Å –¥–≤–æ—Ä–æ–º
- [ ] `get_buildings_list_keyboard(buildings, yard_id, page)` - —Å–ø–∏—Å–æ–∫ –¥–æ–º–æ–≤
- [ ] `get_building_actions_keyboard(building_id)` - –¥–µ–π—Å—Ç–≤–∏—è —Å –¥–æ–º–æ–º
- [ ] `get_apartments_list_keyboard(apartments, building_id, page)` - —Å–ø–∏—Å–æ–∫ –∫–≤–∞—Ä—Ç–∏—Ä
- [ ] `get_apartment_actions_keyboard(apartment_id)` - –¥–µ–π—Å—Ç–≤–∏—è —Å –∫–≤–∞—Ä—Ç–∏—Ä–æ–π
- [ ] `get_buildings_inline_keyboard(buildings)` - –≤—ã–±–æ—Ä –¥–æ–º–∞ (inline)
- [ ] `get_apartments_inline_keyboard(apartments)` - –≤—ã–±–æ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã (inline)

---

### üë• –≠–¢–ê–ü 3: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∂–∏—Ç–µ–ª—è (5-6 —á–∞—Å–æ–≤)

#### 3.1. –û–±–Ω–æ–≤–∏—Ç—å handlers/auth.py (3 —á–∞—Å–∞)

**–ó–∞–¥–∞—á–∞ 3.1.1: –ò–∑–º–µ–Ω–∏—Ç—å flow –∫–æ–º–∞–Ω–¥—ã /join** ‚è±Ô∏è 60 –º–∏–Ω
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `join_with_invite()`:
  - [ ] –ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ –§–ò–û –ø–µ—Ä–µ—Ö–æ–¥ –∫ –≤—ã–±–æ—Ä—É –¥–æ–º–∞
  - [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ `RegistrationStates.waiting_for_building`
- [ ] –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ–º–æ–≤ –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–û—Ç–º–µ–Ω–∞"

**–ó–∞–¥–∞—á–∞ 3.1.2: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –¥–æ–º–∞** ‚è±Ô∏è 40 –º–∏–Ω
- [ ] `handle_building_selection()`:
  - [ ] –ü–∞—Ä—Å–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–æ–º
  - [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å building_id –≤ state
  - [ ] –ü–æ–ª—É—á–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–æ–º–∞
  - [ ] –ü–æ–∫–∞–∑–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –∫–≤–∞—Ä—Ç–∏—Ä
  - [ ] –ü–µ—Ä–µ—Ö–æ–¥ –∫ `RegistrationStates.waiting_for_apartment`
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" (–≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—ã–±–æ—Ä—É –¥–æ–º–∞)

**–ó–∞–¥–∞—á–∞ 3.1.3: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –∫–≤–∞—Ä—Ç–∏—Ä—ã** ‚è±Ô∏è 40 –º–∏–Ω
- [ ] `handle_apartment_selection()`:
  - [ ] –ü–∞—Ä—Å–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–≤–∞—Ä—Ç–∏—Ä—É
  - [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å apartment_id –≤ state
  - [ ] –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–≤–∞—Ä—Ç–∏—Ä–µ
  - [ ] –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
  - [ ] –ü–µ—Ä–µ—Ö–æ–¥ –∫ `RegistrationStates.confirming_registration`

**–ó–∞–¥–∞—á–∞ 3.1.4: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** ‚è±Ô∏è 60 –º–∏–Ω
- [ ] `handle_registration_confirmation()`:
  - [ ] –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å `status="pending"`
  - [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å `requested_apartment_id` –≤ User
  - [ ] –°–æ–∑–¥–∞—Ç—å UserApartment —Å `status="pending"`
  - [ ] –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É –æ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–µ
  - [ ] –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∂–∏—Ç–µ–ª—é –æ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
  - [ ] –û—á–∏—Å—Ç–∏—Ç—å FSM state

**–ó–∞–¥–∞—á–∞ 3.1.5: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `notify_admin_new_registration()`:
  - [ ] –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
    - [ ] –§–ò–û, username, telegram_id
    - [ ] –ó–∞–ø—Ä–æ—à–µ–Ω–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ (–¥–≤–æ—Ä, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞)
    - [ ] –î–∞—Ç–∞ –∑–∞—è–≤–∫–∏
  - [ ] –ö–Ω–æ–ø–∫–∏: [–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å] [–°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫]
  - [ ] –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º –∞–¥–º–∏–Ω–∞–º

#### 3.2. FSM States –∏ Keyboards (1.5 —á–∞—Å–∞)

**–ó–∞–¥–∞—á–∞ 3.2.1: –û–±–Ω–æ–≤–∏—Ç—å states/registration.py** ‚è±Ô∏è 20 –º–∏–Ω
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è:
  - [ ] `waiting_for_building` - –≤—ã–±–æ—Ä –¥–æ–º–∞
  - [ ] `waiting_for_apartment` - –≤—ã–±–æ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏–π

**–ó–∞–¥–∞—á–∞ 3.2.2: –°–æ–∑–¥–∞—Ç—å keyboards/registration.py** ‚è±Ô∏è 60 –º–∏–Ω
- [ ] `get_buildings_selection_keyboard(buildings)`:
  - [ ] –§–æ—Ä–º–∞—Ç: "üè¢ —É–ª. –õ–µ–Ω–∏–Ω–∞, 5 (–î–≤–æ—Ä ‚Ññ1)"
  - [ ] –ü–æ 1 –∫–Ω–æ–ø–∫–µ –≤ —Å—Ç—Ä–æ–∫–µ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
  - [ ] –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∞"
- [ ] `get_apartments_selection_keyboard(apartments)`:
  - [ ] –§–æ—Ä–º–∞—Ç: –Ω–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã
  - [ ] –ü–æ 4 –∫–Ω–æ–ø–∫–∏ –≤ —Å—Ç—Ä–æ–∫–µ (–∫–æ–º–ø–∞–∫—Ç–Ω–æ)
  - [ ] –ö–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –∏ "–û—Ç–º–µ–Ω–∞"
- [ ] `get_registration_confirmation_keyboard()`:
  - [ ] "‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"
  - [ ] "üîô –ò–∑–º–µ–Ω–∏—Ç—å"
  - [ ] "‚ùå –û—Ç–º–µ–Ω–∞"

**–ó–∞–¥–∞—á–∞ 3.2.3: –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `parse_building_selection(text)` - –ø–∞—Ä—Å–∏–Ω–≥ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–æ–º–∞
- [ ] `parse_apartment_selection(text)` - –ø–∞—Ä—Å–∏–Ω–≥ –∫–≤–∞—Ä—Ç–∏—Ä—ã
- [ ] `format_registration_summary(data)` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Ç–æ–≥–∞

---

### ‚úÖ –≠–¢–ê–ü 4: –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∫–≤–∞—Ä—Ç–∏—Ä (6-7 —á–∞—Å–æ–≤)

#### 4.1. –û–±–Ω–æ–≤–∏—Ç—å handlers/user_management.py (4 —á–∞—Å–∞)

**–ó–∞–¥–∞—á–∞ 4.1.1: –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é** ‚è±Ô∏è 60 –º–∏–Ω
- [ ] `show_pending_users()`:
  - [ ] –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö users —Å status="pending"
  - [ ] –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—É—á–∏—Ç—å requested_apartment
  - [ ] –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫:
    - [ ] –§–ò–û
    - [ ] –ó–∞–ø—Ä–æ—à–µ–Ω–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ (–¥–æ–º, –∫–≤.)
    - [ ] –î–∞—Ç–∞ –∑–∞—è–≤–∫–∏
  - [ ] Inline –∫–Ω–æ–ø–∫–∏: [–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞—è–≤–∫—É]
  - [ ] –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤

**–ó–∞–¥–∞—á–∞ 4.1.2: –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–∫–∏** ‚è±Ô∏è 60 –º–∏–Ω
- [ ] `review_user_registration()`:
  - [ ] –ü–æ–ª—É—á–∏—Ç—å User, Apartment, Building, Yard
  - [ ] –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
    - [ ] –§–ò–û, username, telegram_id, —Ç–µ–ª–µ—Ñ–æ–Ω
    - [ ] –î–≤–æ—Ä, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞, —ç—Ç–∞–∂, –ø–æ–¥—ä–µ–∑–¥
    - [ ] –î–∞—Ç–∞ –∑–∞—è–≤–∫–∏
  - [ ] –ö–Ω–æ–ø–∫–∏:
    - [ ] ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É
    - [ ] üîÑ –ò–∑–º–µ–Ω–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É
    - [ ] ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É
    - [ ] ‚óÄÔ∏è –ö —Å–ø–∏—Å–∫—É

**–ó–∞–¥–∞—á–∞ 4.1.3: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã** ‚è±Ô∏è 45 –º–∏–Ω
- [ ] `approve_user_apartment()`:
  - [ ] –í—ã–∑–≤–∞—Ç—å AddressService.approve_apartment()
  - [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å is_primary=True
  - [ ] –û–¥–æ–±—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (status="approved")
  - [ ] –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∂–∏—Ç–µ–ª—é:
    - [ ] ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–¥–æ–±—Ä–µ–Ω–∞
    - [ ] –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞
    - [ ] –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞—è–≤–∫–∏
  - [ ] –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ audit_log
  - [ ] –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –∑–∞—è–≤–æ–∫

**–ó–∞–¥–∞—á–∞ 4.1.4: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã** ‚è±Ô∏è 90 –º–∏–Ω
- [ ] `change_user_apartment_start()`:
  - [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å user_id –≤ FSM state
  - [ ] –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ–º–æ–≤
  - [ ] –ü–µ—Ä–µ—Ö–æ–¥ –∫ `UserModerationStates.selecting_building`
- [ ] `handle_moderation_building_selection()`:
  - [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å building_id
  - [ ] –ü–æ–∫–∞–∑–∞—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–æ–º–∞
  - [ ] –ü–µ—Ä–µ—Ö–æ–¥ –∫ `UserModerationStates.selecting_apartment`
- [ ] `handle_moderation_apartment_selection()`:
  - [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—É—é apartment_id
  - [ ] –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
  - [ ] –ö–Ω–æ–ø–∫–∏: [–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å] [–û—Ç–º–µ–Ω–∞]
- [ ] `confirm_apartment_change()`:
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å User.requested_apartment_id
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å UserApartment
  - [ ] –£–≤–µ–¥–æ–º–∏—Ç—å –∂–∏—Ç–µ–ª—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  - [ ] –û–¥–æ–±—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - [ ] –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É

**–ó–∞–¥–∞—á–∞ 4.1.5: –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏** ‚è±Ô∏è 45 –º–∏–Ω
- [ ] `reject_user_apartment_start()`:
  - [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å user_id –≤ state
  - [ ] –ó–∞–ø—Ä–æ—Å–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
  - [ ] –ü–µ—Ä–µ—Ö–æ–¥ –∫ `UserModerationStates.entering_reject_reason`
- [ ] `reject_user_apartment_with_reason()`:
  - [ ] –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É –∏–∑ message.text
  - [ ] –í—ã–∑–≤–∞—Ç—å AddressService.reject_apartment()
  - [ ] –û—Ç–∫–ª–æ–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å pending
  - [ ] –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∂–∏—Ç–µ–ª—é:
    - [ ] ‚ùå –ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞
    - [ ] –ü—Ä–∏—á–∏–Ω–∞
    - [ ] –ú–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
  - [ ] –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ audit_log
  - [ ] –û—á–∏—Å—Ç–∏—Ç—å FSM state

#### 4.2. FSM States (30 –º–∏–Ω)

**–ó–∞–¥–∞—á–∞ 4.2.1: –°–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å states/user_management.py** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] –î–æ–±–∞–≤–∏—Ç—å `UserModerationStates`:
  - [ ] `selecting_building` - –≤—ã–±–æ—Ä –Ω–æ–≤–æ–≥–æ –¥–æ–º–∞
  - [ ] `selecting_apartment` - –≤—ã–±–æ—Ä –Ω–æ–≤–æ–π –∫–≤–∞—Ä—Ç–∏—Ä—ã
  - [ ] `entering_reject_reason` - –≤–≤–æ–¥ –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
  - [ ] `confirming_change` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

#### 4.3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (1 —á–∞—Å)

**–ó–∞–¥–∞—á–∞ 4.3.1: –®–∞–±–ª–æ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ `config/locales/ru.json`:
  - [ ] `apartment_approval.approved` - –∫–≤–∞—Ä—Ç–∏—Ä–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞
  - [ ] `apartment_approval.changed` - –∫–≤–∞—Ä—Ç–∏—Ä–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –∞–¥–º–∏–Ω–æ–º
  - [ ] `apartment_approval.rejected` - –∑–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞
  - [ ] `apartment_approval.new_request` - –Ω–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –¥–ª—è –∞–¥–º–∏–Ω–∞

**–ó–∞–¥–∞—á–∞ 4.3.2: –§—É–Ω–∫—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `notify_resident_apartment_approved(user, apartment)`
- [ ] `notify_resident_apartment_changed(user, old_apartment, new_apartment)`
- [ ] `notify_resident_apartment_rejected(user, reason)`
- [ ] `notify_admin_new_apartment_request(user, apartment)`

---

### üìù –≠–¢–ê–ü 5: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ —Å –≤—ã–±–æ—Ä–æ–º –∫–≤–∞—Ä—Ç–∏—Ä—ã (4-5 —á–∞—Å–æ–≤)

#### 5.1. –û–±–Ω–æ–≤–∏—Ç—å handlers/requests.py (3 —á–∞—Å–∞)

**–ó–∞–¥–∞—á–∞ 5.1.1: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å get_address_selection_keyboard()** ‚è±Ô∏è 60 –º–∏–Ω
- [ ] –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –ï—Å–ª–∏ –∫–≤–∞—Ä—Ç–∏—Ä –Ω–µ—Ç - –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
- [ ] –î–ª—è –∫–∞–∂–¥–æ–π –∫–≤–∞—Ä—Ç–∏—Ä—ã:
  - [ ] –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç: "üè¢ —É–ª. –õ–µ–Ω–∏–Ω–∞, 5, –∫–≤. 12"
  - [ ] –ï—Å–ª–∏ is_primary - –¥–æ–±–∞–≤–∏—Ç—å ‚≠ê
  - [ ] –°–æ–∑–¥–∞—Ç—å –∫–Ω–æ–ø–∫—É
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–û—Ç–º–µ–Ω–∞"
- [ ] –í–µ—Ä–Ω—É—Ç—å ReplyKeyboardMarkup

**–ó–∞–¥–∞—á–∞ 5.1.2: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å parse_selected_address()** ‚è±Ô∏è 60 –º–∏–Ω
- [ ] –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: selected_text, user_id, db
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–º–µ–Ω—ã
- [ ] –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ (—É–±—Ä–∞—Ç—å ‚≠ê –∏ üè¢)
- [ ] –ü–æ–∏—Å–∫ –∫–≤–∞—Ä—Ç–∏—Ä—ã –≤ UserApartment:
  - [ ] –°–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å —Å —Ñ–æ—Ä–º–∞—Ç–æ–º –∫–Ω–æ–ø–∫–∏
  - [ ] –ü–æ–ª—É—á–∏—Ç—å apartment_id
- [ ] –í–µ—Ä–Ω—É—Ç—å dict:
  - [ ] type: "from_directory"
  - [ ] apartment_id
  - [ ] building_id (–∏–∑ apartment.building)
  - [ ] yard_id (–∏–∑ apartment.building.yard)
  - [ ] address_display (–¥–ª—è –ø–æ–∫–∞–∑–∞)
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ "unknown" –≤—ã–±–æ—Ä–∞

**–ó–∞–¥–∞—á–∞ 5.1.3: –û–±–Ω–æ–≤–∏—Ç—å handle_address_selection()** ‚è±Ô∏è 40 –º–∏–Ω
- [ ] –í—ã–∑–≤–∞—Ç—å –Ω–æ–≤—ã–π parse_selected_address()
- [ ] –ï—Å–ª–∏ type="from_directory":
  - [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ state: apartment_id, building_id, yard_id, address
  - [ ] –ü–µ—Ä–µ—Ö–æ–¥ –∫ –æ–ø–∏—Å–∞–Ω–∏—é
  - [ ] –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ "‚úÖ –ê–¥—Ä–µ—Å –≤—ã–±—Ä–∞–Ω!"
- [ ] –ï—Å–ª–∏ type="cancel":
  - [ ] –û—Ç–º–µ–Ω–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
- [ ] –ï—Å–ª–∏ type="unknown":
  - [ ] –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
  - [ ] –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É

**–ó–∞–¥–∞—á–∞ 5.1.4: –û–±–Ω–æ–≤–∏—Ç—å create_request()** ‚è±Ô∏è 40 –º–∏–Ω
- [ ] –ü–æ–ª—É—á–∏—Ç—å apartment_id –∏–∑ state
- [ ] –ü–µ—Ä–µ–¥–∞—Ç—å –≤ RequestService.create_request()
- [ ] –ü–æ–ª—É—á–∏—Ç—å –∞–≤—Ç–æ—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π full_address –∏–∑ Request
- [ ] –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å –ø–æ–ª–Ω—ã–º –∞–¥—Ä–µ—Å–æ–º:
  - [ ] –î–≤–æ—Ä
  - [ ] –î–æ–º
  - [ ] –ö–≤–∞—Ä—Ç–∏—Ä–∞

**–ó–∞–¥–∞—á–∞ 5.1.5: –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] –í —Å–ø–∏—Å–∫–µ –∑–∞—è–≤–æ–∫ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–¥—Ä–µ—Å –∏–∑ apartment
- [ ] –í –¥–µ—Ç–∞–ª—å–Ω–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:
  - [ ] –î–≤–æ—Ä
  - [ ] –î–æ–º
  - [ ] –ö–≤–∞—Ä—Ç–∏—Ä–∞
  - [ ] (–≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ address)

#### 5.2. –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases (1 —á–∞—Å)

**–ó–∞–¥–∞—á–∞ 5.2.1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ –∫–≤–∞—Ä—Ç–∏—Ä** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏
- [ ] –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: "–£ –≤–∞—Å –Ω–µ—Ç –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã—Ö –∫–≤–∞—Ä—Ç–∏—Ä. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."
- [ ] –ö–Ω–æ–ø–∫–∞ "–°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π"

**–ó–∞–¥–∞—á–∞ 5.2.2: –ö–≤–∞—Ä—Ç–∏—Ä–∞ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –ø—Ä–∏ –≤—ã–±–æ—Ä–µ
- [ ] –ï—Å–ª–∏ –≤—Å–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã - –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

---

### üîß –≠–¢–ê–ü 6: –°–µ—Ä–≤–∏—Å—ã (5-6 —á–∞—Å–æ–≤)

#### 6.1. –°–æ–∑–¥–∞—Ç—å AddressService (4 —á–∞—Å–∞)

**–ó–∞–¥–∞—á–∞ 6.1.1: –°–æ–∑–¥–∞—Ç—å services/address_service.py** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å AddressService
- [ ] –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä: –ø—Ä–∏–Ω–∏–º–∞—Ç—å db (Session)
- [ ] –ò–º–ø–æ—Ä—Ç—ã –º–æ–¥–µ–ª–µ–π: Yard, Building, Apartment, UserApartment

**–ó–∞–¥–∞—á–∞ 6.1.2: –ú–µ—Ç–æ–¥—ã –¥–ª—è –¥–≤–æ—Ä–æ–≤** ‚è±Ô∏è 40 –º–∏–Ω
- [ ] `create_yard(name, description, gps_lat, gps_lon, created_by)`
- [ ] `get_yards(is_active=True)` - —Å–ø–∏—Å–æ–∫ –¥–≤–æ—Ä–æ–≤
- [ ] `get_yard_by_id(yard_id)` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ ID
- [ ] `update_yard(yard_id, **kwargs)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- [ ] `deactivate_yard(yard_id)` - –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è (–ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–æ–º–∞)
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

**–ó–∞–¥–∞—á–∞ 6.1.3: –ú–µ—Ç–æ–¥—ã –¥–ª—è –¥–æ–º–æ–≤** ‚è±Ô∏è 50 –º–∏–Ω
- [ ] `create_building(address, yard_id, gps_lat, gps_lon, entrance_count, floor_count, created_by)`
- [ ] `get_buildings(yard_id=None, is_active=True)` - —Å–ø–∏—Å–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º
- [ ] `get_building_by_id(building_id)` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ ID
- [ ] `update_building(building_id, **kwargs)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- [ ] `deactivate_building(building_id)` - –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è (–ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—ã)
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞

**–ó–∞–¥–∞—á–∞ 6.1.4: –ú–µ—Ç–æ–¥—ã –¥–ª—è –∫–≤–∞—Ä—Ç–∏—Ä** ‚è±Ô∏è 60 –º–∏–Ω
- [ ] `create_apartment(number, building_id, floor, entrance, created_by, **kwargs)`
- [ ] `bulk_create_apartments(building_id, start_num, end_num, floor, entrance, created_by)`
- [ ] `get_apartments(building_id=None, is_active=True)` - —Å–ø–∏—Å–æ–∫
- [ ] `get_apartment_by_id(apartment_id)` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ ID
- [ ] `update_apartment(apartment_id, **kwargs)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- [ ] `deactivate_apartment(apartment_id)` - –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–æ–º–µ—Ä–∞ –≤ –¥–æ–º–µ

**–ó–∞–¥–∞—á–∞ 6.1.5: –ú–µ—Ç–æ–¥—ã –¥–ª—è UserApartment** ‚è±Ô∏è 70 –º–∏–Ω
- [ ] `request_apartment(user_id, apartment_id)` - –∑–∞–ø—Ä–æ—Å –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- [ ] `approve_apartment(user_id, apartment_id, reviewed_by, is_primary=True)` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- [ ] `reject_apartment(user_id, apartment_id, reviewed_by, comment)` - –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
- [ ] `change_user_apartment(user_id, old_apartment_id, new_apartment_id, changed_by)` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∞–¥–º–∏–Ω–æ–º
- [ ] `get_user_apartments(user_id, status="approved")` - –∫–≤–∞—Ä—Ç–∏—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å join)
- [ ] `get_pending_apartment_requests()` - –∑–∞—è–≤–∫–∏ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é
- [ ] `set_primary_apartment(user_id, apartment_id)` - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é –∫–≤–∞—Ä—Ç–∏—Ä—É

**–ó–∞–¥–∞—á–∞ 6.1.6: –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã** ‚è±Ô∏è 50 –º–∏–Ω
- [ ] `get_statistics()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞
- [ ] `find_user_apartment_by_text(user_id, button_text)` - –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É –∫–Ω–æ–ø–∫–∏
- [ ] `validate_apartment_availability(apartment_id)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- [ ] `get_full_address(apartment_id)` - –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å (–¥–≤–æ—Ä + –¥–æ–º + –∫–≤)
- [ ] `search_apartments(query)` - –ø–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É/–∞–¥—Ä–µ—Å—É

#### 6.2. –û–±–Ω–æ–≤–∏—Ç—å RequestService (1 —á–∞—Å)

**–ó–∞–¥–∞—á–∞ 6.2.1: –ò–∑–º–µ–Ω–∏—Ç—å create_request()** ‚è±Ô∏è 40 –º–∏–Ω
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `apartment_id=None`
- [ ] –ï—Å–ª–∏ apartment_id:
  - [ ] –ü–æ–ª—É—á–∏—Ç—å Apartment –∏–∑ –ë–î
  - [ ] –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å address: `{building.address}, –∫–≤. {number}`
  - [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å apartment_id –≤ Request
- [ ] –ò–Ω–∞—á–µ:
  - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π address (legacy)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ Request

**–ó–∞–¥–∞—á–∞ 6.2.2: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ get_request_full_address()** ‚è±Ô∏è 20 –º–∏–Ω
- [ ] –ï—Å–ª–∏ request.apartment_id:
  - [ ] –í–µ—Ä–Ω—É—Ç—å –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞
- [ ] –ò–Ω–∞—á–µ:
  - [ ] –í–µ—Ä–Ω—É—Ç—å request.address (legacy)

#### 6.3. –û–±–Ω–æ–≤–∏—Ç—å GeoOptimizer (30 –º–∏–Ω)

**–ó–∞–¥–∞—á–∞ 6.3.1: –ò–∑–º–µ–Ω–∏—Ç—å get_request_coordinates()** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] –ï—Å–ª–∏ request.apartment_id:
  - [ ] –ü–æ–ª—É—á–∏—Ç—å apartment.building
  - [ ] –í–µ—Ä–Ω—É—Ç—å (gps_latitude, gps_longitude)
- [ ] –ò–Ω–∞—á–µ:
  - [ ] Fallback –Ω–∞ –ø–∞—Ä—Å–∏–Ω–≥ –∞–¥—Ä–µ—Å–∞ (legacy)
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ GPS –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã

---

### üß™ –≠–¢–ê–ü 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (4-5 —á–∞—Å–æ–≤)

#### 7.1. Unit —Ç–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π (1.5 —á–∞—Å–∞)

**–ó–∞–¥–∞—á–∞ 7.1.1: tests/test_yard_model.py** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `test_create_yard()` - —Å–æ–∑–¥–∞–Ω–∏–µ –¥–≤–æ—Ä–∞
- [ ] `test_yard_uniqueness()` - —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è
- [ ] `test_yard_relationships()` - —Å–≤—è–∑–∏ —Å –¥–æ–º–∞–º–∏
- [ ] `test_yard_properties()` - buildings_count

**–ó–∞–¥–∞—á–∞ 7.1.2: tests/test_building_model.py** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `test_create_building()` - —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–º–∞
- [ ] `test_building_yard_relationship()` - —Å–≤—è–∑—å —Å –¥–≤–æ—Ä–æ–º
- [ ] `test_building_apartments_relationship()` - —Å–≤—è–∑—å —Å –∫–≤–∞—Ä—Ç–∏—Ä–∞–º–∏

**–ó–∞–¥–∞—á–∞ 7.1.3: tests/test_apartment_model.py** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `test_create_apartment()` - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã
- [ ] `test_apartment_unique_constraint()` - —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –Ω–æ–º–µ—Ä–∞ –≤ –¥–æ–º–µ
- [ ] `test_apartment_relationships()` - —Å–≤—è–∑–∏

#### 7.2. Unit —Ç–µ—Å—Ç—ã AddressService (2 —á–∞—Å–∞)

**–ó–∞–¥–∞—á–∞ 7.2.1: tests/test_address_service.py - CRUD –¥–≤–æ—Ä–æ–≤** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `test_create_yard()`
- [ ] `test_get_yards()`
- [ ] `test_update_yard()`
- [ ] `test_deactivate_yard()`
- [ ] `test_deactivate_yard_with_active_buildings()` - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞

**–ó–∞–¥–∞—á–∞ 7.2.2: tests/test_address_service.py - CRUD –¥–æ–º–æ–≤** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `test_create_building()`
- [ ] `test_get_buildings_filtered_by_yard()`
- [ ] `test_update_building()`
- [ ] `test_deactivate_building_with_apartments()` - –æ—à–∏–±–∫–∞

**–ó–∞–¥–∞—á–∞ 7.2.3: tests/test_address_service.py - CRUD –∫–≤–∞—Ä—Ç–∏—Ä** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `test_create_apartment()`
- [ ] `test_bulk_create_apartments()`
- [ ] `test_apartment_number_uniqueness()`
- [ ] `test_get_apartments_filtered()`

**–ó–∞–¥–∞—á–∞ 7.2.4: tests/test_address_service.py - UserApartment** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `test_request_apartment()`
- [ ] `test_approve_apartment()`
- [ ] `test_reject_apartment()`
- [ ] `test_change_user_apartment()`
- [ ] `test_get_user_apartments()`

#### 7.3. Integration —Ç–µ—Å—Ç—ã (1 —á–∞—Å)

**–ó–∞–¥–∞—á–∞ 7.3.1: tests/test_registration_with_apartment.py** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `test_full_registration_flow()`:
  - [ ] –°–æ–∑–¥–∞—Ç—å yard, building, apartments
  - [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å /join —Å —Ç–æ–∫–µ–Ω–æ–º
  - [ ] –í—ã–±—Ä–∞—Ç—å –¥–æ–º –∏ –∫–≤–∞—Ä—Ç–∏—Ä—É
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ UserApartment(pending)
- [ ] `test_admin_approves_apartment()`:
  - [ ] –ê–¥–º–∏–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∫–≤–∞—Ä—Ç–∏—Ä—É
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å UserApartment(approved)
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å User(approved)

**–ó–∞–¥–∞—á–∞ 7.3.2: tests/test_request_with_apartment.py** ‚è±Ô∏è 30 –º–∏–Ω
- [ ] `test_create_request_with_apartment()`:
  - [ ] –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É —Å apartment_id
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—é address
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ apartment_id
- [ ] `test_request_list_shows_apartment()`:
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞

---

### üìö –≠–¢–ê–ü 8: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (2 —á–∞—Å–∞)

**–ó–∞–¥–∞—á–∞ 8.1: –°–æ–∑–¥–∞—Ç—å docs/ADDRESS_DIRECTORY_GUIDE.md** ‚è±Ô∏è 90 –º–∏–Ω
- [ ] –í–≤–µ–¥–µ–Ω–∏–µ –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è
- [ ] –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–¥–∏–∞–≥—Ä–∞–º–º–∞)
- [ ] Workflow –º–æ–¥–µ—Ä–∞—Ü–∏–∏ (–±–ª–æ–∫-—Å—Ö–µ–º–∞)
- [ ] –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
  - [ ] –°–æ–∑–¥–∞–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞
  - [ ] –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∑–∞—è–≤–æ–∫
  - [ ] –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- [ ] –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
  - [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –≤—ã–±–æ—Ä–æ–º –∫–≤–∞—Ä—Ç–∏—Ä—ã
  - [ ] –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
- [ ] API AddressService (–º–µ—Ç–æ–¥—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
- [ ] –°—Ö–µ–º–∞ –ë–î (ERD –¥–∏–∞–≥—Ä–∞–º–º–∞)

**–ó–∞–¥–∞—á–∞ 8.2: –û–±–Ω–æ–≤–∏—Ç—å MemoryBank/activeContext.md** ‚è±Ô∏è 20 –º–∏–Ω
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª "TASK 15: –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∞–¥—Ä–µ—Å–æ–≤"
- [ ] –û–ø–∏—Å–∞—Ç—å –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ–µ–∫—Ç–∞

**–ó–∞–¥–∞—á–∞ 8.3: –û–±–Ω–æ–≤–∏—Ç—å MemoryBank/tasks.md** ‚è±Ô∏è 10 –º–∏–Ω
- [ ] –û—Ç–º–µ—Ç–∏—Ç—å Task 15 –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

---

## üìà –ú–ï–¢–†–ò–ö–ò –£–°–ü–ï–•–ê

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:
- ‚úÖ –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å 100+ –∫–≤–∞—Ä—Ç–∏—Ä –∑–∞ 5 –º–∏–Ω—É—Ç (–º–∞—Å—Å–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ)
- ‚úÖ –í—Ä–µ–º—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∂–∏—Ç–µ–ª—è: 2-3 –º–∏–Ω—É—Ç—ã (–≤—ã–±–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞)
- ‚úÖ –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∑–∞—è–≤–∫–∏ –∞–¥–º–∏–Ω–æ–º: 30 —Å–µ–∫—É–Ω–¥
- ‚úÖ –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏: 1-2 –º–∏–Ω—É—Ç—ã (–∞–¥—Ä–µ—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- ‚úÖ 0 –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∞–¥—Ä–µ—Å–æ–≤ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ constraint)

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ:
- ‚úÖ 4 –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
- ‚úÖ 20+ –º–µ—Ç–æ–¥–æ–≤ –≤ AddressService
- ‚úÖ 95%+ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
- ‚úÖ –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –æ–±—Ä–∞—Ç–∏–º—ã–µ
- ‚úÖ GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è 100% –∑–∞—è–≤–æ–∫ –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞

### –ë–∏–∑–Ω–µ—Å:
- ‚úÖ –°–Ω–∏–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ –∞–¥—Ä–µ—Å–∞—Ö –Ω–∞ 100%
- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Ñ–µ–π–∫–æ–≤—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
- ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ –ø–æ —Ä–∞–π–æ–Ω–∞–º
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –£–ö

---

## üîÑ –ó–ê–í–ò–°–ò–ú–û–°–¢–ò

### –ë–ª–æ–∫–∏—Ä—É–µ—Ç:
- Task 16: –ì–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (–Ω—É–∂–Ω—ã GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)
- Task 17: –ó–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π (–Ω—É–∂–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–≤–æ—Ä–æ–≤)

### –¢—Ä–µ–±—É–µ—Ç:
- ‚úÖ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ PostgreSQL 15 –≥–æ—Ç–æ–≤–∞
- ‚úÖ Alembic –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ User –∏ Request —Å—É—â–µ—Å—Ç–≤—É—é—Ç

---

## üö® –†–ò–°–ö–ò –ò –ú–ò–¢–ò–ì–ê–¶–ò–Ø

### –†–∏—Å–∫ 1: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å**: –ù–∏–∑–∫–∞—è
**–í–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ**: –í—ã—Å–æ–∫–æ–µ
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
- –°–æ–∑–¥–∞—Ç—å backup –ë–î –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ –∫–æ–ø–∏–∏ –ë–î
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è –∫–∞–∫ deprecated (–Ω–∞ –≤—Ä–µ–º—è)

### –†–∏—Å–∫ 2: –ê–¥–º–∏–Ω –Ω–µ —É—Å–ø–µ–µ—Ç –º–æ–¥–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞—è–≤–∫–∏
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å**: –°—Ä–µ–¥–Ω—è—è
**–í–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ**: –°—Ä–µ–¥–Ω–µ–µ
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω—É –æ –Ω–æ–≤—ã—Ö –∑–∞—è–≤–∫–∞—Ö
- –°—á–µ—Ç—á–∏–∫ pending –∑–∞—è–≤–æ–∫ –≤ –∞–¥–º–∏–Ω-–º–µ–Ω—é
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–∞—Å—Å–æ–≤–æ–≥–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è

### –†–∏—Å–∫ 3: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø–æ–π–º—É—Ç –Ω–æ–≤—ã–π flow
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å**: –°—Ä–µ–¥–Ω—è—è
**–í–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ**: –ù–∏–∑–∫–æ–µ
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
- –ü–æ—à–∞–≥–æ–≤—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤ UI
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–º–æ—â—å" —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

---

## üìù –ß–ï–ö–õ–ò–°–¢ –ì–û–¢–û–í–ù–û–°–¢–ò –ö PRODUCTION

### –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º:
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (95%+ –ø–æ–∫—Ä—ã—Ç–∏–µ)
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –∫–æ–ø–∏–∏ production –ë–î
- [ ] Backup –ë–î —Å–æ–∑–¥–∞–Ω
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
- [ ] –ê–¥–º–∏–Ω—ã –æ–±—É—á–µ–Ω—ã —Ä–∞–±–æ—Ç–µ —Å–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–º
- [ ] Rollback –ø–ª–∞–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω

### –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ (24 —á–∞—Å–∞)
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î)
- [ ] –°–±–æ—Ä feedback –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ —É—Å–ø–µ—Ö–∞
- [ ] –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ UI (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

---

## üìä –ü–†–û–ì–†–ï–°–° –í–´–ü–û–õ–ù–ï–ù–ò–Ø

**–§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å**: ‚úÖ **100% –ó–ê–í–ï–†–®–ï–ù–û**

### ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

#### **1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (100%)**
- [x] –ú–æ–¥–µ–ª—å Yard —Å GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
- [x] –ú–æ–¥–µ–ª—å Building —Å –∞–¥—Ä–µ—Å–∞–º–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- [x] –ú–æ–¥–µ–ª—å Apartment —Å –ø–æ–¥—ä–µ–∑–¥–∞–º–∏/—ç—Ç–∞–∂–∞–º–∏
- [x] –ú–æ–¥–µ–ª—å UserApartment –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- [x] 2 –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic (create, update)

#### **2. AddressService (100%)**
- [x] CRUD –¥–≤–æ—Ä–æ–≤ (20+ –º–µ—Ç–æ–¥–æ–≤)
- [x] CRUD –∑–¥–∞–Ω–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- [x] CRUD –∫–≤–∞—Ä—Ç–∏—Ä + bulk_create
- [x] –°–∏—Å—Ç–µ–º–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∫–≤–∞—Ä—Ç–∏—Ä
- [x] –ß–∏—Å–ª–æ–≤–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∫–≤–∞—Ä—Ç–∏—Ä

#### **3. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (100%)**
- [x] address_yards.py - –ø–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–æ—Ä–∞–º–∏
- [x] address_buildings.py - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–¥–∞–Ω–∏—è–º–∏
- [x] address_apartments.py - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä–∞–º–∏ + –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
- [x] address_moderation.py - –º–æ–¥–µ—Ä–∞—Ü–∏—è –∑–∞—è–≤–æ–∫

#### **4. UX —É–ª—É—á—à–µ–Ω–∏—è (100%)**
- [x] HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–≥–ª–æ–±–∞–ª—å–Ω—ã–π ParseMode)
- [x] –í—ã–±–æ—Ä –∑–¥–∞–Ω–∏—è –ø–µ—Ä–µ–¥ —Å–ø–∏—Å–∫–æ–º –∫–≤–∞—Ä—Ç–∏—Ä
- [x] –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö —Å–ø–∏—Å–∫–æ–≤
- [x] –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—Ç–º–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏–π
- [x] –ß–∏—Å–ª–æ–≤–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –Ω–æ–º–µ—Ä–æ–≤

#### **5. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ (100%)**
- [x] Foreign Key Constraint (user.id vs telegram_id)
- [x] Property setter (apartments_count)
- [x] SQLAlchemy unique() –¥–ª—è joinedload
- [x] Deprecated —Ñ—É–Ω–∫—Ü–∏–∏ –≤ address_helpers.py

---

## üéâ –ò–¢–û–ì–ò –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- **–ù–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤**: 15
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞**: 3500+
- **–ú–æ–¥–µ–ª–µ–π –ë–î**: 4 –Ω–æ–≤—ã–µ
- **–°–µ—Ä–≤–∏—Å–æ–≤**: 1 (AddressService —Å 20+ –º–µ—Ç–æ–¥–∞–º–∏)
- **Handlers**: 4 –º–æ–¥—É–ª—è
- **–ú–∏–≥—Ä–∞—Ü–∏–π**: 2
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: ~8 —á–∞—Å–æ–≤ (–≤–º–µ—Å—Ç–æ 41-53 —á–∞—Å–æ–≤) ‚ö°

### ‚úÖ –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∞–¥—Ä–µ—Å–æ–≤
- ‚úÖ –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –î–≤–æ—Ä ‚Üí –î–æ–º ‚Üí –ö–≤–∞—Ä—Ç–∏—Ä–∞ ‚Üí –ñ–∏—Ç–µ–ª—å
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∫–≤–∞—Ä—Ç–∏—Ä
- ‚úÖ –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ 500 –∫–≤–∞—Ä—Ç–∏—Ä –∑–∞ —Ä–∞–∑
- ‚úÖ GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —á–∏—Å–ª–æ–≤–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
- ‚úÖ –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
- ‚úÖ Production Ready –∫–∞—á–µ—Å—Ç–≤–æ (9.8/10)

### üéØ –ë–∏–∑–Ω–µ—Å-—Ü–µ–Ω–Ω–æ—Å—Ç—å:
- **–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–∞–Ω–Ω—ã—Ö**: 100% - –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ú–æ–¥–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ñ–µ–π–∫–æ–≤—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- **UX**: –í—ã–±–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞ –±—ã—Å—Ç—Ä–µ–µ —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –°–æ–∑–¥–∞–Ω–∏–µ 100+ –∫–≤–∞—Ä—Ç–∏—Ä –∑–∞ 5 –º–∏–Ω—É—Ç
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –º–Ω–æ–∂–µ—Å—Ç–≤—É –£–ö

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 12 –æ–∫—Ç—è–±—Ä—è 2025
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π**: Claude Code
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û**
**–ö–∞—á–µ—Å—Ç–≤–æ**: 9.8/10 (Production Ready)
