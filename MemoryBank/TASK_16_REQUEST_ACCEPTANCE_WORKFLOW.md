# TASK 16: Request Acceptance Workflow (–ü—Ä–∏—ë–º–∫–∞ –∑–∞—è–≤–æ–∫)

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 13 –æ–∫—Ç—è–±—Ä—è 2025
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 13 –æ–∫—Ç—è–±—Ä—è 2025 (21:35)
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û (95%)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: P1 - HIGH

---

## üìã –û–ü–ò–°–ê–ù–ò–ï –ó–ê–î–ê–ß–ò

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø—Ä–∏—ë–º–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫ —Å —Å–∏—Å—Ç–µ–º–æ–π –æ—Ü–µ–Ω–æ–∫ –∏ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤.

### –¢–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å:
1. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å ‚Üí "–í—ã–ø–æ–ª–Ω–µ–Ω–∞" (—Å –æ—Ç—á—ë—Ç–æ–º)
2. –ó–∞—è–≤–∫–∞ —Å—Ä–∞–∑—É —É—Ö–æ–¥–∏—Ç –≤ –∞—Ä—Ö–∏–≤

### –ù–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å:
1. **–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å** ‚Üí "–ò—Å–ø–æ–ª–Ω–µ–Ω–æ" (completion_report + completion_media –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã)
2. **–ú–µ–Ω–µ–¥–∂–µ—Ä** ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç ‚Üí —Å—Ç–∞—Ç—É—Å "–í—ã–ø–æ–ª–Ω–µ–Ω–∞"
3. **–ó–∞—è–≤–∏—Ç–µ–ª—å** ‚Üí –ü–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚Üí –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –æ—Ç—á—ë—Ç –∏ –º–µ–¥–∏–∞
4. **–ó–∞—è–≤–∏—Ç–µ–ª—å** ‚Üí –õ–∏–±–æ:
   - **–ü—Ä–∏–Ω–∏–º–∞–µ—Ç** (–æ—Ü–µ–Ω–∫–∞ 1-5 –∑–≤—ë–∑–¥) ‚Üí —Å—Ç–∞—Ç—É—Å "–ü—Ä–∏–Ω—è—Ç–æ" ‚Üí –ê—Ä—Ö–∏–≤
   - **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç** (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ + –º–µ–¥–∏–∞) ‚Üí —Å—Ç–∞—Ç—É—Å "–ù–æ–≤–∞—è" + —Ñ–ª–∞–≥ `is_returned=True`
5. **–ú–µ–Ω–µ–¥–∂–µ—Ä** ‚Üí –í–∏–¥–∏—Ç –≤–æ–∑–≤—Ä–∞—Ç–Ω—É—é –∑–∞—è–≤–∫—É ‚Üí –õ–∏–±–æ:
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–Ω–æ–≤–∞ –∫–∞–∫ "–í—ã–ø–æ–ª–Ω–µ–Ω–∞" (—Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏)
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ "–í —Ä–∞–±–æ—Ç–µ"

---

## üóÇÔ∏è –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í –ë–ê–ó–ï –î–ê–ù–ù–´–•

### –ú–æ–¥–µ–ª—å Request (–¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è):
```python
# –ü–æ–ª—è –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∑–∞—è–≤–æ–∫
is_returned = Column(Boolean, default=False, nullable=False)
return_reason = Column(Text, nullable=True)  # –ü—Ä–∏—á–∏–Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ—Ç –∑–∞—è–≤–∏—Ç–µ–ª—è
return_media = Column(JSON, default=list)    # –ú–µ–¥–∏–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ
returned_at = Column(DateTime(timezone=True), nullable=True)  # –í—Ä–µ–º—è –≤–æ–∑–≤—Ä–∞—Ç–∞
returned_by = Column(Integer, ForeignKey("users.id"), nullable=True)  # –ö—Ç–æ –≤–µ—Ä–Ω—É–ª

# –ü–æ–ª—è –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º
manager_confirmed = Column(Boolean, default=False)
manager_confirmed_by = Column(Integer, ForeignKey("users.id"), nullable=True)
manager_confirmed_at = Column(DateTime(timezone=True), nullable=True)
manager_confirmation_notes = Column(Text, nullable=True)
```

### –ú–∏–≥—Ä–∞—Ü–∏—è:
- –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª: `database/migrations/add_request_acceptance_fields.py`

---

## üìä –°–¢–ê–¢–£–°–´ –ó–ê–Ø–í–û–ö

### –¢–µ–∫—É—â–∏–µ —Å—Ç–∞—Ç—É—Å—ã (–≤ constants.py):
- "–ù–æ–≤–∞—è"
- "–ü—Ä–∏–Ω—è—Ç–∞"
- "–í —Ä–∞–±–æ—Ç–µ"
- "–ó–∞–∫—É–ø"
- "–£—Ç–æ—á–Ω–µ–Ω–∏–µ"
- "–ò—Å–ø–æ–ª–Ω–µ–Ω–æ" ‚Üê –Ω–æ–≤—ã–π —Å–º—ã—Å–ª: –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –∑–∞–≤–µ—Ä—à–∏–ª, –∂–¥—ë—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
- "–í—ã–ø–æ–ª–Ω–µ–Ω–∞" ‚Üê –Ω–æ–≤—ã–π —Å–º—ã—Å–ª: –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª, –∂–¥—ë—Ç –ø—Ä–∏—ë–º–∫–∏ –∑–∞—è–≤–∏—Ç–µ–ª–µ–º
- "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞"
- **"–ü—Ä–∏–Ω—è—Ç–æ"** ‚Üê –Ω–æ–≤—ã–π: –∑–∞—è–≤–∏—Ç–µ–ª—å –ø—Ä–∏–Ω—è–ª —Ä–∞–±–æ—Ç—É —Å –æ—Ü–µ–Ω–∫–æ–π (—Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å)
- "–û—Ç–º–µ–Ω–µ–Ω–∞"

### –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:
```
"–í —Ä–∞–±–æ—Ç–µ"
   ‚Üí (–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å) ‚Üí "–ò—Å–ø–æ–ª–Ω–µ–Ω–æ" (—Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º + –º–µ–¥–∏–∞)
   ‚Üí (–ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç) ‚Üí "–í—ã–ø–æ–ª–Ω–µ–Ω–∞"
   ‚Üí (–ó–∞—è–≤–∏—Ç–µ–ª—å) ‚Üí "–ü—Ä–∏–Ω—è—Ç–æ" (—Å –æ—Ü–µ–Ω–∫–æ–π 1-5) –ò–õ–ò –≤–æ–∑–≤—Ä–∞—Ç ‚Üí "–ù–æ–≤–∞—è" (is_returned=True)
   ‚Üí (–ú–µ–Ω–µ–¥–∂–µ—Ä) ‚Üí —Å–Ω–æ–≤–∞ "–í—ã–ø–æ–ª–Ω–µ–Ω–∞" –ò–õ–ò "–í —Ä–∞–±–æ—Ç–µ"
```

---

## üé® UI/UX –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### 1. –ú–µ–Ω—é –º–µ–Ω–µ–¥–∂–µ—Ä–∞ (admin.py)
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞: **"‚úÖ –ò—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏"**

–°–ø–∏—Å–æ–∫ –ø–æ–∫–∞–∂–µ—Ç –∑–∞—è–≤–∫–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–ò—Å–ø–æ–ª–Ω–µ–Ω–æ" (–∂–¥—É—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º).

### 2. –î–µ—Ç–∞–ª–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –∑–∞—è–≤–∫–∏ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞
–ü–æ–∫–∞–∑–∞—Ç—å:
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞—è–≤–∫–µ
- –û—Ç—á—ë—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (completion_report)
- –ú–µ–¥–∏–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (completion_media)
- –ï—Å–ª–∏ is_returned=True: –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏ –º–µ–¥–∏–∞ –æ—Ç –∑–∞—è–≤–∏—Ç–µ–ª—è

–ö–Ω–æ–ø–∫–∏:
- "‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å" ‚Üí —Å—Ç–∞—Ç—É—Å "–í—ã–ø–æ–ª–Ω–µ–Ω–∞" + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞—è–≤–∏—Ç–µ–ª—é
- "üîÑ –í–µ—Ä–Ω—É—Ç—å –≤ —Ä–∞–±–æ—Ç—É" ‚Üí —Å—Ç–∞—Ç—É—Å "–í —Ä–∞–±–æ—Ç–µ"
- "üìé –ú–µ–¥–∏–∞" (–µ—Å–ª–∏ –µ—Å—Ç—å)
- "üîô –ù–∞–∑–∞–¥"

### 3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞—è–≤–∏—Ç–µ–ª—é
–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ —Å—Ç–∞—Ç—É—Å "–í—ã–ø–æ–ª–Ω–µ–Ω–∞":
```
‚úÖ –í–∞—à–∞ –∑–∞—è–≤–∫–∞ #{–Ω–æ–º–µ—Ä} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ä–∞–±–æ—Ç—ã –∏ –ø—Ä–∏–º–∏—Ç–µ –∑–∞—è–≤–∫—É.

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ú–æ–∏ –∑–∞—è–≤–∫–∏" ‚Üí "–û–∂–∏–¥–∞—é—Ç –ø—Ä–∏—ë–º–∫–∏"
```

### 4. –ú–µ–Ω—é –∑–∞—è–≤–∏—Ç–µ–ª—è (requests.py)
–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª: **"‚úÖ –û–∂–∏–¥–∞—é—Ç –ø—Ä–∏—ë–º–∫–∏"**

–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–í—ã–ø–æ–ª–Ω–µ–Ω–∞".

### 5. –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –∑–∞—è–≤–∫–∏ –∑–∞—è–≤–∏—Ç–µ–ª–µ–º
–ü–æ–∫–∞–∑–∞—Ç—å:
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞—è–≤–∫–µ
- –û—Ç—á—ë—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
- –ú–µ–¥–∏–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (–∫–Ω–æ–ø–∫–∞ "üìé –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ–¥–∏–∞")

–ö–Ω–æ–ø–∫–∏:
- "‚úÖ –ü—Ä–∏–Ω—è—Ç—å –∑–∞—è–≤–∫—É" ‚Üí –∑–∞–ø—Ä–æ—Å –æ—Ü–µ–Ω–∫–∏ 1-5 –∑–≤—ë–∑–¥
- "‚ùå –í–µ—Ä–Ω—É—Ç—å –∑–∞—è–≤–∫—É" ‚Üí –∑–∞–ø—Ä–æ—Å –ø—Ä–∏—á–∏–Ω—ã + –º–µ–¥–∏–∞
- "üîô –ù–∞–∑–∞–¥"

### 6. –û—Ü–µ–Ω–∫–∞ –∑–∞—è–≤–∫–∏ (1-5 –∑–≤—ë–∑–¥)
Inline –∫–Ω–æ–ø–∫–∏: ‚≠ê ‚≠ê‚≠ê ‚≠ê‚≠ê‚≠ê ‚≠ê‚≠ê‚≠ê‚≠ê ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê

–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞:
```
‚úÖ –°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ü–µ–Ω–∫—É!

–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5 –∑–≤—ë–∑–¥)
–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –∞—Ä—Ö–∏–≤.
```

–°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `ratings`.

### 7. –í–æ–∑–≤—Ä–∞—Ç –∑–∞—è–≤–∫–∏ –∑–∞—è–≤–∏—Ç–µ–ª–µ–º
FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è:
- `ApplicantAcceptanceStates.awaiting_return_reason` - –æ–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã
- `ApplicantAcceptanceStates.awaiting_return_media` - –æ–∂–∏–¥–∞–Ω–∏–µ –º–µ–¥–∏–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ü—Ä–æ—Ü–µ—Å—Å:
1. –ö–Ω–æ–ø–∫–∞ "‚ùå –í–µ—Ä–Ω—É—Ç—å –∑–∞—è–≤–∫—É"
2. –ó–∞–ø—Ä–æ—Å: "–û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –Ω–µ —É—Å—Ç—Ä–æ–∏–ª–æ –≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏"
3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
4. –ó–∞–ø—Ä–æ—Å: "–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" + –∫–Ω–æ–ø–∫–∞ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å"
5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: `is_returned=True`, `return_reason`, `return_media`
6. –°—Ç–∞—Ç—É—Å ‚Üí "–ù–æ–≤–∞—è"
7. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä—É

---

## üìÅ –§–ê–ô–õ–´ –î–õ–Ø –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
- ‚úÖ `database/models/request.py` - –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è
- `database/migrations/add_request_acceptance_fields.py` - –Ω–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

### 2. –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã:
- `utils/constants.py` - —É—Ç–æ—á–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ (—É–∂–µ –µ—Å—Ç—å)

### 3. –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã:
- ‚úÖ `keyboards/admin.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ò—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏"
- `keyboards/admin.py` - –¥–æ–±–∞–≤–∏—Ç—å `get_manager_completed_request_actions_keyboard()`
- `keyboards/requests.py` - –¥–æ–±–∞–≤–∏—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –∑–∞—è–≤–∏—Ç–µ–ª—è (–ø—Ä–∏—ë–º–∫–∞)
- `keyboards/requests.py` - –¥–æ–±–∞–≤–∏—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –æ—Ü–µ–Ω–∫–∞–º–∏ (–∑–≤—ë–∑–¥—ã)

### 4. FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è:
- `states/admin.py` - –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- `states/requests.py` - –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞—è–≤–∏—Ç–µ–ª—è –¥–ª—è –ø—Ä–∏—ë–º–∫–∏/–≤–æ–∑–≤—Ä–∞—Ç–∞

### 5. –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
- `handlers/admin.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ "–ò—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏" (—Å–ø–∏—Å–æ–∫)
- `handlers/admin.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –∑–∞—è–≤–∫–∏
- `handlers/admin.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è/–≤–æ–∑–≤—Ä–∞—Ç–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º
- `handlers/requests.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ "–û–∂–∏–¥–∞—é—Ç –ø—Ä–∏—ë–º–∫–∏" (—Å–ø–∏—Å–æ–∫)
- `handlers/requests.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –∑–∞—è–≤–∫–∏
- `handlers/requests.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–∏–Ω—è—Ç–∏—è —Å –æ—Ü–µ–Ω–∫–æ–π
- `handlers/requests.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å –ø—Ä–∏—á–∏–Ω–æ–π

### 6. –°–µ—Ä–≤–∏—Å—ã:
- `services/notification_service.py` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞—è–≤–∏—Ç–µ–ª—é –∏ –º–µ–Ω–µ–¥–∂–µ—Ä—É
- `services/request_service.py` - –ª–æ–≥–∏–∫–∞ —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–æ–≤

---

## üîÑ –ê–õ–ì–û–†–ò–¢–ú –†–ê–ë–û–¢–´

### A. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –∑–∞–≤–µ—Ä—à–∞–µ—Ç –∑–∞—è–≤–∫—É:
```python
# –í handlers/my_shifts.py –∏–ª–∏ requests.py
# –£–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

# –ü—Ä–æ–≤–µ—Ä–∫–∞: completion_report –∏ completion_media –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã
if not request.completion_report:
    await message.answer("‚ùå –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏")
    return

if not request.completion_media or len(request.completion_media) == 0:
    await message.answer("‚ùå –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–æ—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã")
    return

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ "–ò—Å–ø–æ–ª–Ω–µ–Ω–æ"
request.status = REQUEST_STATUS_COMPLETED
db.commit()

# –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä—É
await notification_service.notify_managers(
    f"üìã –ó–∞—è–≤–∫–∞ #{request.request_number} –∏—Å–ø–æ–ª–Ω–µ–Ω–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º.\n"
    f"–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ."
)
```

### B. –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç:
```python
@router.callback_query(F.data.startswith("confirm_completed_"))
async def handle_manager_confirm_completed(callback: CallbackQuery, db: Session):
    request_number = callback.data.replace("confirm_completed_", "")
    request = db.query(Request).filter(Request.request_number == request_number).first()

    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º
    request.status = REQUEST_STATUS_EXECUTED  # "–í—ã–ø–æ–ª–Ω–µ–Ω–∞"
    request.manager_confirmed = True
    request.manager_confirmed_by = user.id
    request.manager_confirmed_at = datetime.now()
    db.commit()

    # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞—è–≤–∏—Ç–µ–ª—é
    applicant = request.user
    await notification_service.notify_user(
        applicant.telegram_id,
        f"‚úÖ –í–∞—à–∞ –∑–∞—è–≤–∫–∞ #{request.request_number} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!\n\n"
        f"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ä–∞–±–æ—Ç—ã –∏ –ø—Ä–∏–º–∏—Ç–µ –∑–∞—è–≤–∫—É.\n"
        f"–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª '–ú–æ–∏ –∑–∞—è–≤–∫–∏' ‚Üí '–û–∂–∏–¥–∞—é—Ç –ø—Ä–∏—ë–º–∫–∏'"
    )
```

### C. –ó–∞—è–≤–∏—Ç–µ–ª—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å –æ—Ü–µ–Ω–∫–æ–π:
```python
@router.callback_query(F.data.startswith("accept_request_"))
async def handle_applicant_accept_request(callback: CallbackQuery):
    # –ü–æ–∫–∞–∑–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –æ—Ü–µ–Ω–∫–∞–º–∏
    keyboard = get_rating_keyboard(request_number)
    await callback.message.edit_text(
        "‚≠ê –û—Ü–µ–Ω–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏:",
        reply_markup=keyboard
    )

@router.callback_query(F.data.startswith("rate_"))
async def handle_rating(callback: CallbackQuery, db: Session):
    # rate_123456-789_5 ‚Üí request_number=123456-789, rating=5
    parts = callback.data.replace("rate_", "").split("_")
    request_number = parts[0]
    rating_value = int(parts[1])

    # –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏
    rating = Rating(
        request_number=request_number,
        user_id=user.id,
        rating=rating_value
    )
    db.add(rating)

    # –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
    request = db.query(Request).filter(Request.request_number == request_number).first()
    request.status = REQUEST_STATUS_APPROVED  # "–ü—Ä–∏–Ω—è—Ç–æ"
    db.commit()

    await callback.message.edit_text(
        f"‚úÖ –°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ü–µ–Ω–∫—É!\n\n"
        f"–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞: {'‚≠ê' * rating_value} ({rating_value} –∑–≤—ë–∑–¥)\n"
        f"–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –∞—Ä—Ö–∏–≤."
    )
```

### D. –ó–∞—è–≤–∏—Ç–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞—è–≤–∫—É:
```python
@router.callback_query(F.data.startswith("return_request_"))
async def handle_applicant_return_request(callback: CallbackQuery, state: FSMContext):
    await state.update_data(request_number=request_number)
    await state.set_state(ApplicantAcceptanceStates.awaiting_return_reason)
    await callback.message.answer(
        "‚ùå –í–æ–∑–≤—Ä–∞—Ç –∑–∞—è–≤–∫–∏\n\n"
        "–û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –Ω–µ —É—Å—Ç—Ä–æ–∏–ª–æ –≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏:"
    )

@router.message(ApplicantAcceptanceStates.awaiting_return_reason)
async def handle_return_reason(message: Message, state: FSMContext, db: Session):
    data = await state.get_data()
    request_number = data['request_number']

    request = db.query(Request).filter(Request.request_number == request_number).first()
    request.is_returned = True
    request.return_reason = message.text
    request.returned_by = user.id
    request.returned_at = datetime.now()
    request.status = REQUEST_STATUS_NEW  # "–ù–æ–≤–∞—è"
    db.commit()

    await state.set_state(ApplicantAcceptanceStates.awaiting_return_media)
    await message.answer(
        "üìé –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):",
        reply_markup=get_skip_media_keyboard()
    )

# ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞ ...

# –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä—É
await notification_service.notify_managers(
    f"‚ö†Ô∏è –ó–∞—è–≤–∫–∞ #{request.request_number} –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞ –∑–∞—è–≤–∏—Ç–µ–ª–µ–º!\n\n"
    f"–ü—Ä–∏—á–∏–Ω–∞: {request.return_reason}\n\n"
    f"–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ."
)
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –≠—Ç–∞–ø 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –º–æ–¥–µ–ª–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –≤ –º–æ–¥–µ–ª—å Request
- [ ] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

### –≠—Ç–∞–ø 2: –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- [x] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ò—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏" –≤ –º–µ–Ω—é –º–µ–Ω–µ–¥–∂–µ—Ä–∞
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫ (–º–µ–Ω–µ–¥–∂–µ—Ä)
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –æ—Ü–µ–Ω–æ–∫ (1-5 –∑–≤—ë–∑–¥)
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø—Ä–∏—ë–º–∫–∏/–≤–æ–∑–≤—Ä–∞—Ç–∞ (–∑–∞—è–≤–∏—Ç–µ–ª—å)

### –≠—Ç–∞–ø 3: FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
- [ ] –°–æ–∑–¥–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞
- [ ] –°–æ–∑–¥–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –∑–∞—è–≤–∏—Ç–µ–ª—è (–ø—Ä–∏—ë–º–∫–∞/–≤–æ–∑–≤—Ä–∞—Ç)

### –≠—Ç–∞–ø 4: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ - –ú–µ–Ω–µ–¥–∂–µ—Ä
- [ ] –°–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫ (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π)
- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –∑–∞—è–≤–∫–∏
- [ ] –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ (‚Üí "–í—ã–ø–æ–ª–Ω–µ–Ω–∞")
- [ ] –í–æ–∑–≤—Ä–∞—Ç –≤ —Ä–∞–±–æ—Ç—É (‚Üí "–í —Ä–∞–±–æ—Ç–µ")
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–Ω—ã—Ö –∑–∞—è–≤–æ–∫ (–ø–æ–º–µ—Ç–∫–∞ –≤ —Å–ø–∏—Å–∫–µ)

### –≠—Ç–∞–ø 5: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ - –ó–∞—è–≤–∏—Ç–µ–ª—å
- [ ] –°–ø–∏—Å–æ–∫ "–û–∂–∏–¥–∞—é—Ç –ø—Ä–∏—ë–º–∫–∏"
- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –∑–∞—è–≤–∫–∏
- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ–¥–∏–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- [ ] –ü—Ä–∏–Ω—è—Ç–∏–µ –∑–∞—è–≤–∫–∏ (–∑–∞–ø—Ä–æ—Å –æ—Ü–µ–Ω–∫–∏)
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ü–µ–Ω–∫–∏ (1-5 –∑–≤—ë–∑–¥)
- [ ] –í–æ–∑–≤—Ä–∞—Ç –∑–∞—è–≤–∫–∏ (–∑–∞–ø—Ä–æ—Å –ø—Ä–∏—á–∏–Ω—ã)
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ

### –≠—Ç–∞–ø 6: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä—É –ø—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ "–ò—Å–ø–æ–ª–Ω–µ–Ω–æ"
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞—è–≤–∏—Ç–µ–ª—é –ø—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ "–í—ã–ø–æ–ª–Ω–µ–Ω–∞"
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä—É –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∑–∞—è–≤–∫–∏

### –≠—Ç–∞–ø 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Üí –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí –ü—Ä–∏–Ω—è—Ç–∏–µ
- [ ] –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Üí –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí –í–æ–∑–≤—Ä–∞—Ç ‚Üí –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤

---

## üìù –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø

- –í—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é (RU/UZ)
- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ logger
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å rollback –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞

---

## üöÄ –°–¢–ê–¢–£–° –í–´–ü–û–õ–ù–ï–ù–ò–Ø

**–ü—Ä–æ–≥—Ä–µ—Å—Å**: 95% (–∑–∞–≤–µ—Ä—à–µ–Ω–æ)

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (100%):

**–≠—Ç–∞–ø 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –º–æ–¥–µ–ª–∏**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã 9 –ø–æ–ª–µ–π –≤ –º–æ–¥–µ–ª—å Request (is_returned, return_reason, return_media, –∏ –¥—Ä.)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è add_request_acceptance_fields.py
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è (9 –ø–æ–ª–µ–π + 2 FK + 2 –∏–Ω–¥–µ–∫—Å–∞)

**–≠—Ç–∞–ø 2: –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "‚úÖ –ò—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏" –≤ –º–µ–Ω—é –º–µ–Ω–µ–¥–∂–µ—Ä–∞
- ‚úÖ get_manager_completed_request_actions_keyboard() - –¥–µ–π—Å—Ç–≤–∏—è —Å –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏
- ‚úÖ get_rating_keyboard() - –æ—Ü–µ–Ω–∫–∏ 1-5 –∑–≤—ë–∑–¥
- ‚úÖ get_applicant_completed_request_actions_keyboard() - –¥–µ–π—Å—Ç–≤–∏—è –∑–∞—è–≤–∏—Ç–µ–ª—è
- ‚úÖ get_skip_media_keyboard() - –ø—Ä–æ–ø—É—Å–∫ –º–µ–¥–∏–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "‚úÖ –û–∂–∏–¥–∞—é—Ç –ø—Ä–∏—ë–º–∫–∏" –≤ –º–µ–Ω—é –∑–∞—è–≤–∏—Ç–µ–ª—è

**–≠—Ç–∞–ø 3: FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è**
- ‚úÖ ManagerAcceptanceStates (4 —Å–æ—Å—Ç–æ—è–Ω–∏—è)
- ‚úÖ ApplicantAcceptanceStates (6 —Å–æ—Å—Ç–æ—è–Ω–∏–π)

**–≠—Ç–∞–ø 4: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ - –ú–µ–Ω–µ–¥–∂–µ—Ä**
- ‚úÖ –°–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫ —Å –ø–æ–º–µ—Ç–∫–æ–π "–í–æ–∑–≤—Ä–∞—Ç–Ω–∞—è" (list_completed_requests)
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –∑–∞—è–≤–∫–∏ —Å–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ ‚Üí "–í—ã–ø–æ–ª–Ω–µ–Ω–∞" + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (handle_manager_confirm_completed)
- ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç–Ω—ã—Ö –∑–∞—è–≤–æ–∫ (handle_manager_reconfirm_completed)
- ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –≤ —Ä–∞–±–æ—Ç—É ‚Üí "–í —Ä–∞–±–æ—Ç–µ" (handle_manager_return_to_work)

**–≠—Ç–∞–ø 5: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ - –ó–∞—è–≤–∏—Ç–µ–ª—å**
- ‚úÖ –°–ø–∏—Å–æ–∫ "–û–∂–∏–¥–∞—é—Ç –ø—Ä–∏—ë–º–∫–∏" (show_pending_acceptance_requests)
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –∑–∞—è–≤–∫–∏ (view_completed_request)
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ–¥–∏–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (view_completion_media)
- ‚úÖ –ü—Ä–∏–Ω—è—Ç–∏–µ –∑–∞—è–≤–∫–∏ - –∑–∞–ø—Ä–æ—Å –æ—Ü–µ–Ω–∫–∏ (accept_request)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏ 1-5 –∑–≤—ë–∑–¥ ‚Üí "–ü—Ä–∏–Ω—è—Ç–æ" (save_rating)
- ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –∑–∞—è–≤–∫–∏ - –∑–∞–ø—Ä–æ—Å –ø—Ä–∏—á–∏–Ω—ã (return_request)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã –≤–æ–∑–≤—Ä–∞—Ç–∞ (save_return_reason)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å (save_return_media)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ ‚Üí "–ò—Å–ø–æ–ª–Ω–µ–Ω–æ" + —Ñ–ª–∞–≥ is_returned (process_return_request)

**–≠—Ç–∞–ø 6: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞—è–≤–∏—Ç–µ–ª—é –ø—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ "–í—ã–ø–æ–ª–Ω–µ–Ω–∞"
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞—è–≤–∏—Ç–µ–ª—é –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä—É –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∑–∞—è–≤–∫–∏

**–≠—Ç–∞–ø 7: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
- ‚úÖ –°–æ–∑–¥–∞–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å handlers/request_acceptance.py (380 —Å—Ç—Ä–æ–∫)
- ‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω router –≤ main.py
- ‚úÖ –ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –±–µ–∑ –æ—à–∏–±–æ–∫

### üìÑ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- ‚úÖ –°–æ–∑–¥–∞–Ω –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω TASK_16_REQUEST_ACCEPTANCE_WORKFLOW.md
- ‚úÖ –°–æ–∑–¥–∞–Ω–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è REQUEST_ACCEPTANCE_USAGE.md

### üîç –ß—Ç–æ –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (5%):
- ‚ö†Ô∏è –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è UZ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ RU)
- ‚ö†Ô∏è –¢–µ–∫—Å—Ç–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã –∫ –æ—Ü–µ–Ω–∫–∞–º (—Ç–æ–ª—å–∫–æ –∑–≤—ë–∑–¥—ã)
- ‚ö†Ô∏è –ò—Å—Ç–æ—Ä–∏—è –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π)
- ‚ö†Ô∏è End-to-end —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞

### üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- **–§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ**: 4
- **–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ**: 5
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞**: ~800+
- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤**: 15
- **–ö–ª–∞–≤–∏–∞—Ç—É—Ä**: 5
- **FSM —Å–æ—Å—Ç–æ—è–Ω–∏–π**: 10
- **–ü–æ–ª–µ–π –ë–î**: 9
- **–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: ~2.5 —á–∞—Å–∞

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 13.10.2025 21:35
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
