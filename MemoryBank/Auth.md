## PLAN

### Предварительная декомпозиция задач (без изменений моделей)

- **Политика доступа и статусы**
  - Ввести строгую политику: `pending` — доступны только профиль/онбординг; создание заявок и любые действия запрещены; `approved` — полный доступ по роли; `blocked` — мягкая блокировка с явным сообщением.
  - Точки контроля:
    - Middleware на уровне апдейтов/роутеров для быстрой отсечки по `status`.
    - В хэндлерах «Создать заявку», «Мои заявки», все админ/исполнителские действия — ранние проверки.
  - Критерии: тесты подтверждают, что `pending` не может создать/менять заявки; `blocked` получает локализованное уведомление.

- **Инвайты (без БД-таблиц)**
  - Статлес‑приглашения: HMAC‑подпись с `INVITE_SECRET` (env), в токене: `role`, `specialization` (для исполнителя), `expires_at`, `nonce`.
  - Команды:
    - Менеджер: «Сгенерировать пригласительный» → получает токен/QR.
    - Кандидат: `/join <token>` → валидация (подпись, срок), установка `roles+=role`, `status="pending"`, заполнение `specialization` (если executor).
  - Ограничения/безопасность: rate‑limit на ввод токена, одноразовость через `nonce`/AuditLog (пометка использованного).
  - Критерии: токены валидируются без БД‑схем; неверные/просроченные отклоняются; операции пишутся в `AuditLog`.

- **Онбординг заявителя**
  - `/start` → онбординг + «Поделиться телефоном» (request_contact) → сохранение `phone`.
  - Сбор `home_address` (валидация, нормализация).
  - Статус по умолчанию `pending` до одобрения менеджером.
  - Критерии: после онбординга пользователь в `pending`; доступно только профиль/помощь.

- **Онбординг исполнителя**
  - `/join <token>` (тип `executor`) → создание/обновление пользователя, добавление роли, установка `specialization` из токена или выбор из констант.
  - Статус `pending` до одобрения менеджером.
  - Критерии: без одобрения — нет доступа к сменам/действиям; после одобрения — доступно при активной смене.

- **Менеджеры: супер‑менеджер и приглашения**
  - Супер‑менеджер из env (ID/список ID). Первичная выдача прав — через пароль из env (без дефолта).
  - Приглашение менеджера: токен типа `manager`, затем ручное подтверждение в панели (двойное подтверждение).
  - Критерии: только менеджер может создать инвайт; повышение до `manager` фиксируется в `AuditLog` и требует подтверждения.

- **Панель менеджера (управление пользователями)**
  - Списки: новые (pending), одобренные, заблокированные — отдельно по всем и по сотрудникам.
  - Действия:
    - Одобрить/заблокировать пользователя с комментарием (в `AuditLog.details`).
    - Назначить/снять роли (из набора `applicant/executor/manager`).
    - Исполнители: назначение специализации.
  - «Распределение специализаций»: список исполнителей, массовое/мультивыбор специализаций.
    - Без изменения модели: хранить несколько специализаций как CSV в `User.specialization` (валидация/нормализация при чтении/записи).
  - Критерии: операции доступны только менеджерам; все действия пишутся в аудит; списки фильтруются корректно.

- **Профиль пользователя (UI/данные)**
  - Отображение статуса/ролей/активной роли/телефона.
  - Адреса: показывать `home_address`, `apartment_address`, `yard_address`. 
    - Если требуется «несколько дворов» без изменения модели — поддержать разделитель `;` в `yard_address` и вывод списком.
  - Критерии: профиль целостно отражает данные; локализованы подписи.

- **Глобальный аудит**
  - Фиксировать: регистрация, ввод инвайта (role, exp, ok/fail), назначение/снятие ролей, смена статуса, смена специализации, одобрение/блокировка.
  - Формат `AuditLog.details`: краткий JSON с ключевыми полями.
  - Критерии: события видны через простой экспорт/лог.

- **Ограничения и защита**
  - Rate‑limit на `/join` и ввод токенов (в памяти; аналогично уже реализованному для смены роли).
  - Запрет дефолтного `ADMIN_PASSWORD`; обязательный `INVITE_SECRET` и SUPER_MANAGER_IDS.
  - Критерии: защитные проверки активны; попытки превышения лимитов фиксируются.

- **Локализация**
  - Добавить ключи: онбординг, «вы заблокированы», приглашения (успех/ошибка/просрочен), списки пользователей/сотрудников, специализации (множественные), пояснения статусов.
  - Критерии: RU/UZ покрыты; fallback работает.

- **Тесты**
  - Юнит‑тесты:
    - Валидация/парсинг инвайтов (HMAC, exp, role, specialization).
    - Политика статусов: `pending` — запреты; `blocked` — блокировка.
    - Панель менеджера: переходы статусов и ролей, специализации (CSV).
  - Интеграционные:
    - Поток заявителя: онбординг → pending → одобрение → создание заявки.
    - Поток исполнителя: инвайт → pending → одобрение → смена → действие по заявке.
    - Повышение до менеджера: инвайт → подтверждение → доступ к панели.
  - Критерии: все новые тесты зелёные, без регресса текущих.

- **Конфигурация/флаги**
  - Env:
    - `INVITE_SECRET` (обязателен), `SUPER_MANAGER_IDS` (список), `AUTO_APPROVE_APPLICANTS=false` (по умолчанию), `JOIN_RATE_LIMIT_WINDOW`, `JOIN_RATE_LIMIT_MAX`.
  - Критерии: отсутствие критичных переменных блокирует соответствующий функционал с явным логом.

### Приоритет (волны)

- **Wave 1 (Политики и базовые ограничения)**
  - Строгая политика статусов + локализация «заблокирован».
  - Онбординг заявителя (телефон, адрес).
  - Отображение адресов в профиле.
  - Базовые тесты.

- **Wave 2 (Инвайты)**
  - HMAC‑токены, `/join`, rate‑limit, аудит.
  - Инвайт исполнителя с специализацией.
  - Тесты инвайтов.

- **Wave 3 (Панель менеджера)**
  - Списки (новые/одобренные/заблокированные; сотрудники отдельно).
  - Действия: одобрить/заблокировать/роли/специализация (CSV).
  - Тесты управления.

- **Wave 4 (Менеджеры)**
  - Супер‑менеджер из env; инвайт менеджера; двойное подтверждение.
  - Тесты повышения.

- **Wave 5 (Полировка/безопасность)**
  - Усиление rate‑limit, журналирование, UX‑улучшения, локали.

### Зависимости и совместимость

- Без изменения моделей: используем `AuditLog` для событий, статлес‑инвайты (HMAC), CSV в `User.specialization` для множественных специализаций (минимальная цена изменений).
- Совместимо с текущими middleware/сервисами: ролевая модель и смены остаются прежними, добавляются только проверки статусов и новые хэндлеры/клавиатуры/тексты.

### Критерии готовности (DoD)

- **Прозрачное разделение потоков по ролям**: подтверждено тестами и UI.
- **Управление доступом через приглашения/одобрения**: работает без новых таблиц.
- **Совместимость сохранена**: текущие сценарии не ломаются.
- **Полный аудит критических действий**: все ключевые события фиксируются.

- Итог: декомпозиция покрывает политику статусов, инвайты без схемы БД, менеджерскую модерацию, профиль пользователя и тесты, соблюдая ваши требования и текущую архитектуру.


### Тикеты (AUTH-*)

- AUTH-1: Политика статусов — базовые ограничения
  - Суть: Ограничить доступ `pending/blocked` на уровне middleware и ранних проверок в ключевых хэндлерах.
  - DoD: `pending` не может создать/редактировать заявки; `blocked` получает локализованное сообщение; тесты зелёные.

- AUTH-2: Локализация статусов и блокировок
  - Суть: Добавить тексты RU/UZ для «вы заблокированы», подсказок для `pending`/онбординга.
  - DoD: Ключи в локалях, покрытие тестами `get_text`.

- AUTH-3: Онбординг заявителя (телефон + базовый адрес)
  - Суть: Сценарий `/start` → request_contact → сохранение `phone` → ввод `home_address` (валидация/нормализация).
  - DoD: Полный поток до `pending` с отображением только профиля/помощи; тест на валидность данных.

- AUTH-4: Инвайты — формат токена (статлес, HMAC)
  - Суть: Определить структуру токена (`role`, `specialization`, `expires_at`, `nonce`) и HMAC‑подпись c `INVITE_SECRET`.
  - DoD: Утилиты генерации/валидации + юнит‑тесты (валидный, просрочен, подделка).

- AUTH-5: Команда `/join <token>`
  - Суть: Принимать токен, валидировать, назначать роль, проставлять `status="pending"`, сохранять специализацию для исполнителя.
  - DoD: Отказы на неверные/просроченные; запись события в `AuditLog`; юнит‑тесты.

- AUTH-6: Rate‑limit на `/join`
  - Суть: Защитить ввод токенов (окно и лимит попыток, in‑memory).
  - DoD: Лимит соблюдается; негативные тесты.

- AUTH-7: Панель менеджера — списки пользователей
  - Суть: Разделы: «Новые», «Одобренные», «Заблокированные», отдельные списки для сотрудников.
  - DoD: Корректная фильтрация и пагинация; доступ только менеджеру.

- AUTH-8: Панель менеджера — действия над пользователем
  - Суть: Одобрить/заблокировать, назначить/снять роли; комментарий в `AuditLog.details`.
  - DoD: Все переходы отражаются в аудите; тесты переходов.

- AUTH-9: Исполнители — специализации
  - Суть: Назначение/мультивыбор специализаций (CSV в `User.specialization` без изменения модели).
  - DoD: Отображение/редактирование, валидация значений, тесты.

- AUTH-10: Профиль — отображение данных
  - Суть: Показ статуса/ролей/active_role/phone и адресов (`home/apartment/yard`; yard поддерживает `;` для списка).
  - DoD: Локализованные подписи, корректный вывод множественных дворов.

- AUTH-11: Супер‑менеджер и инвайт менеджера
  - Суть: Поддержка SUPER_MANAGER_IDS из env; генерация менеджерского инвайта; двойное подтверждение повышения.
  - DoD: Аудит повышения; тесты на доступ/подтверждение.

- AUTH-12: Аудит критических действий
  - Суть: Регистрация, `/join`, роли/статусы, специализации, одобрение/блокировка — единый формат details.
  - DoD: Юнит‑тесты на запись аудита; выборочная проверка полей.

- AUTH-13: Набор тестов (E2E сценарии)
  - Суть: Онбординг заявителя (pending→approved→создание заявки), исполнитель (инвайт→approved→смена→действие), повышение менеджера.
  - DoD: Все сценарии зелёные, регресс нет.

- AUTH-14: Конфигурация и безопасность
  - Суть: Обязательные переменные `INVITE_SECRET`, `SUPER_MANAGER_IDS`; запрет дефолтного `ADMIN_PASSWORD`.
  - DoD: Отсутствие переменных → явный лог и отключение функций; тесты конфигурации.


## PLAN AUTH-1 — Политика статусов (pending/approved/blocked)

### Цели
- Ввести базовые ограничения по статусам на уровне middleware и ранних проверок в хэндлерах:
  - `blocked` — мягкая блокировка (одно локализованное сообщение, дальнейшая обработка не выполняется).
  - `pending` — доступ только к профилю/онбордингу/справке; любые «рабочие» действия (создание/изменение заявок, админ/исполнительские действия, запуск/сдача смен) запрещены с локализованной подсказкой.
  - `approved` — поведение без ограничений, согласно ролям/режиму и контексту смен.

### Изменения по модулям
- `uk_management_bot/middlewares/auth.py`
  - Использовать локализацию через `utils.helpers.get_text` вместо хардкода.
  - Для `blocked`: отправлять `get_text("auth.blocked", language)` и завершать обработку (return без вызова `handler`).
  - Для `pending`: записывать `data["user_status"] = "pending"`; обработку не прерывать (решение — на уровне хэндлеров с ранними проверками).
  - Добавить защиту от повторной отправки одного и того же предупреждения в рамках одного события (простейший флаг в `data`, например `data["_auth_warned"] = True`).

- `uk_management_bot/handlers/requests.py`
  - В точках «первого касания» рабочих действий (создание заявки, изменения статуса, подтверждения) добавить раннюю проверку `user_status == "pending"` → ответ `get_text("auth.pending")` и ранний выход.
  - Просмотр списков и деталей — разрешить, чтобы пользователь мог ориентироваться в системе.

- `uk_management_bot/handlers/shifts.py`
  - Перед запуском/сдачей смены — проверка статуса: при `pending` → `get_text("auth.pending")`, ранний выход.

- `uk_management_bot/handlers/admin.py`
  - Для административных действий — проверка: `user_status == "approved"` + наличие роли `manager`. При `pending`/`blocked` — локализованный отказ.

- `uk_management_bot/config/locales/{ru,uz}.json`
  - Ключи уже присутствуют: `auth.blocked`, `auth.pending`, `auth.approved` — дополнительной правки не требуется.

### Поведенческие правила (UX)
- Сообщения об ограничениях не должны спамить пользователя: одно сообщение на событие/действие.
- Базовые команды (`/start`, `/help`, профиль) доступны при любом статусе.
- Подсказки — короткие, локализованные, без алертов, если это не `blocked`.

### DoD (критерии приёмки)
- `blocked`: пользователь получает локализованное сообщение и дальнейшая обработка не происходит.
- `pending`: создание/изменение заявок, смены и админ‑действия отклоняются локализованным сообщением; просмотр остаётся доступным.
- Локализация используется везде (без хардкода текстов в middleware/хэндлерах).
- Негативные сценарии не приводят к исключениям; дефолты и фолбэк локализации работают.
- Все существующие тесты — зелёные; новые тесты политики статусов — зелёные.

### Тест‑план
- Юнит:
  - `middlewares/auth.py`: событие Message/CallbackQuery для `blocked` (ранний выход) и `pending` (маркировка статуса, без раннего выхода).
  - Валидация локализации: `get_text("auth.blocked")`/`get_text("auth.pending")` возвращают строки для RU/UZ и корректно фолбэчатся на RU.
- Интеграция:
  - Попытка создания заявки при `pending` → отказ с `auth.pending`; при `approved` → успех.
  - Попытка запуска смены при `pending` → отказ; при `approved` → успех.
  - Админ‑действия при `pending`/`blocked` → отказ, при `approved` + `manager` → успех.

### Команды
```bash
pytest -k "auth or requests or shifts or admin" -q | cat
```


## CREATIVE AUTH-1 — Дизайн политики статусов

1️⃣ ПРОБЛЕМА
- Нужно ввести понятные и единообразные ограничения по статусам пользователя:
  - `blocked` — полностью запрещён доступ с мягким уведомлением.
  - `pending` — разрешены только базовые команды/профиль/онбординг; «рабочие» действия (создание/изменение заявок, смены, админ‑функции) должны корректно отклоняться.
  - `approved` — без ограничений, далее действуют RBAC и контекст смен.

2️⃣ ОПЦИИ
- A: Полная блокировка `pending` в middleware (как `blocked`) — ранний выход для любых событий.
- B: Middleware только маркирует `data['user_status']`, а ранние проверки и ответы выполняются точечно в хэндлерах «рабочих» действий.
- C: Централизовать в сервисах (Request/Shift/Admin): сервисы возвращают отказ по статусу, а хэндлеры показывают сообщение.

3️⃣ АНАЛИЗ
| Критерий | A: блок в middleware | B: метка + проверки в хэндлерах | C: проверки в сервисах |
|---|---|---|---|
| Простота | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| Точность UX | ⭐⭐ (грубая отсечка) | ⭐⭐⭐⭐⭐ (по месту действия) | ⭐⭐⭐⭐ |
| Тестируемость | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| Риск регрессий | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |

Ключевые инсайты:
- Полная блокировка `pending` (A) ломает доступ к профилю/онбордингу и мешает гибкому UX.
- Проверки в хэндлерах (B) дают наилучший контроль и понятные сообщения «по месту» без усложнения сервисного слоя.
- Сервисные проверки (C) полезны как дополнительная защита, но усложняют слой бизнес‑логики и дублируют ответственность.

4️⃣ РЕШЕНИЕ
- Выбрать B: middleware формирует `data['user']` и `data['user_status']`, для `blocked` выполняет мягкую блокировку и ранний выход; для `pending` — НЕ прерывает обработку.
- «Рабочие» хэндлеры выполняют ранние проверки статуса и отвечают локализованным текстом (`auth.pending`).

5️⃣ ИМПЛЕМЕНТАЦИОННЫЕ ЗАМЕТКИ
- Middleware (`middlewares/auth.py`):
  - Сообщение для `blocked` брать через `get_text('auth.blocked', language)`; для CallbackQuery — `show_alert=True`.
  - Для `pending`: только установить `data['user_status'] = 'pending'`, без сообщений и раннего выхода.
  - Fail‑safe: при исключениях — дефолты и продолжение цепочки.
- Хэндлеры (ранние проверки):
  - `handlers/requests.py`: создание заявки, изменения статусов — при `pending` → ответ `get_text('auth.pending')`, ранний выход; просмотр/списки — разрешены.
  - `handlers/shifts.py`: старт/сдача смены — отказ при `pending` с `auth.pending`.
  - `handlers/admin.py`: любые действия — отказ при `pending/blocked`; при `approved` дополнительно проверяется роль `manager`.
- Локализация: ключи `auth.pending`, `auth.blocked`, `auth.approved` уже есть в RU/UZ — переиспользовать, без хардкода.
- Анти‑спам: в одном апдейте не дублировать одно и то же уведомление (можно использовать флаг в `data`).

6️⃣ ВЕРИФИКАЦИЯ
- [ ] `blocked`: локализованное сообщение и ранний выход на уровне middleware.
- [ ] `pending`: рабочие действия отклоняются по месту; базовые команды доступны.
- [ ] Все тексты — через `get_text`; фолбэк RU работает.
- [ ] Тесты юнит/интеграция по сценариям отказа/успеха зелёные.


## ✅ REFLECT AUTH-1 — Политика статусов (pending/approved/blocked)

### Сделано
- `middlewares/auth.py`:
  - Сообщение блокировки переведено на локализацию `get_text("auth.blocked")` с учётом языка пользователя.
  - Для статуса `blocked` реализован мягкий ранний выход (без вызова хэндлера).
  - Fail‑safe поведение сохранено.
- Ранние проверки `pending` добавлены в хэндлеры:
  - `uk_management_bot/handlers/requests.py`: старт создания заявки, выбор категории/срочности, подтверждение.
  - `uk_management_bot/handlers/shifts.py`: старт смены, подтверждение сдачи.
  - `uk_management_bot/handlers/admin.py`: панель и все менеджерские действия.
- Ответы при `pending` — локализованные (`get_text("auth.pending")`).

### Результаты тестов
- Запуск через указанный venv:
  - Команда: `"uk_management_bot/venv/bin/python" -m pytest -q`
  - Итог: **38 passed, 3 warnings** (~1.1s)
- Предупреждения (неблокирующие):
  - SQLAlchemy `MovedIn20Warning` для `declarative_base()`.
  - `SAWarning` об `overlaps` для `Request.executor`/`User.executed_requests`.

### Вывод / соответствие DoD
- `blocked`: локализованное сообщение + ранний выход — выполнено.
- `pending`: рабочие действия отклоняются «по месту», базовые команды доступны — выполнено.
- Локализация используется в middleware/хэндлерах — выполнено.
- Все тесты зелёные; регрессий нет — выполнено.

### Незавершено/улучшения
- Анти‑спам уведомлений в рамках одного апдейта (опциональный флаг в `data`) — можно добавить при необходимости.
- Приглушить предупреждения SQLAlchemy:
  - заменить `declarative_base()` на `sqlalchemy.orm.declarative_base()`;
  - добавить `overlaps="executed_requests"` к `Request.executor` или настроить `back_populates`.

### Артефакты
- `uk_management_bot/middlewares/auth.py`
- `uk_management_bot/handlers/requests.py`
- `uk_management_bot/handlers/shifts.py`
- `uk_management_bot/handlers/admin.py`

## PLAN AUTH-2 — Локализация статусов и блокировок (RU/UZ)

### Цели
- Обеспечить полноту и консистентность локалей RU/UZ по статусам/блокировкам и сопутствующим сообщениям.
- Гарантировать корректный фолбэк на RU и единый формат плейсхолдеров.

### Область работ
- Файлы: `uk_management_bot/config/locales/ru.json`, `uk_management_bot/config/locales/uz.json`.
- Модули для проверки использования ключей: `middlewares/auth.py`, `handlers/*`, `services/notification_service.py`, `utils/helpers.py`.

### Ключи для аудита/добавления (при отсутствии — добавить)
- `auth.blocked`, `auth.pending`, `auth.approved` — тексты статусов/блокировок.
- `roles.applicant`, `roles.executor`, `roles.manager` — отображаемые названия ролей.
- `errors.permission_denied` — отказ по правам.
- `notify.denied_title`, `notify.reason.rate_limited` — заголовок и причины отказов, связанные с политикой.
- При необходимости: отдельные короткие версии сообщений (hint vs full) — например, `auth.pending_hint`.

### Правила форматирования
- Плейсхолдеры только в фигурных скобках: `{role}`, `{name}` и т. п.
- Паритет эмодзи/пунктуации между RU/UZ.
- Без пустых значений; при отсутствии ключа в UZ — фолбэк на RU.

### Изменения (при необходимости)
- В местах вызова локализации убедиться, что используются корректные ключи (`get_text("auth.blocked")`, `get_text("auth.pending")`).
- При необходимости заменить хардкод на использование `get_text` (проверка выполнена в AUTH‑1 для middleware; повторный аудит остальных хэндлеров/сервисов).

### DoD (критерии приёмки)
- RU/UZ содержат все используемые ключи из списка выше; пустых значений нет.
- Плейсхолдеры корректны и единообразны; паритет эмодзи/пунктуации выдержан.
- Все обращения к локали в коде используют существующие ключи; при отсутствии — срабатывает фолбэк на RU.
- Тесты по локализации — зелёные; регрессий нет.

### Тест‑план
- Юнит: `utils.helpers.get_text`
  - Возврат RU/UZ по ключам `auth.*`, `roles.*`, `errors.permission_denied`, `notify.*`.
  - Фолбэк на RU при отсутствии ключа в UZ.
  - Замена плейсхолдеров.
- Интеграция:
  - Сообщение о блокировке в middleware: RU/UZ.
  - Отказы при `pending` в `requests/shifts/admin`: RU/UZ.

### Команды
```bash
pytest -k "helpers or notifications or role_mode or auth" -q | cat
```

## CREATIVE AUTH-2 — Дизайн локализации статусов и блокировок

1️⃣ ПРОБЛЕМА
- Обеспечить полную и консистентную локализацию RU/UZ для статусов пользователя и сопутствующих сообщений (блокировки, подсказки pending), с корректным фолбэком и единым стилем (эмодзи, пунктуация, плейсхолдеры).

2️⃣ ОПЦИИ
- A: «Минимальная синхронизация» — проверить наличие текущих ключей и добавить недостающие точечно.
- B: «Неймспейсы и выравнивание» — зафиксировать обязательные ключи `auth.*`, `roles.*`, `errors.permission_denied`, `notify.*`; добавить короткий `auth.pending_hint`; выровнять стиль (эмодзи/пунктуация/плейсхолдеры).
- C: «Инструментальная валидация» — добавить скрипт проверки паритета ключей RU/UZ (тест/утилита), автопаддинг отсутствующих ключей плейсхолдером.

3️⃣ АНАЛИЗ
| Критерий | A: минимал | B: выравнивание | C: валидатор |
|---|---|---|---|
| Скорость внедрения | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| Качество/устойчивость | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| Сложность поддержки | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐ |
| Ценность для проекта | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |

Ключевые инсайты:
- Текущее покрытие уже хорошее; основная ценность — зафиксировать обязательный набор ключей и единый стиль (B), а валидатор (C) можно добавить позже.

4️⃣ РЕШЕНИЕ
- Выбрать B сейчас (быстрое выравнивание и фиксация набора ключей), оставить возможность внедрить C как улучшение.

5️⃣ ИМПЛЕМЕНТАЦИОННЫЕ ЗАМЕТКИ
- Аудит и правки локалей:
  - Проверить наличие: `auth.blocked`, `auth.pending`, `auth.approved`, `roles.*`, `errors.permission_denied`, `notify.denied_title`, `notify.reason.rate_limited`.
  - Добавить `auth.pending_hint` (короткая версия для ненавязчивых подсказок).
  - Выровнять эмодзи и пунктуацию между RU/UZ; плейсхолдеры только `{name}`/`{role}` и т.п.
- Аудит кода:
  - Убедиться, что все новые/используемые ключи существуют; заменить хардкод на `get_text` при необходимости.
  - Проверить, что язык берётся из `message.from_user.language_code`/`callback.from_user.language_code` с фолбэком на `ru`.
- (На потом) Валидация: скрипт сравнения ключей RU/UZ с отчётом о расхождениях, интегрировать в тесты.

6️⃣ ВЕРИФИКАЦИЯ
- [ ] В RU/UZ присутствуют все ключи из обязательного набора, пустых значений нет.
- [ ] Сообщения `auth.blocked`/`auth.pending` корректно отображаются в middleware/хэндлерах для RU/UZ.
- [ ] Эмодзи/пунктуация/плейсхолдеры выровнены между RU/UZ.
- [ ] Юнит‑тесты `get_text` проходят (включая фолбэк и подстановку плейсхолдеров).

