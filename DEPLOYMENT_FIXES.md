# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–î–∞—Ç–∞**: 15 –æ–∫—Ç—è–±—Ä—è 2025
**–ü—Ä–æ–±–ª–µ–º–∞**: –û—à–∏–±–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ `make start` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

---

## üêõ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ö†Ô∏è "The 'afe' variable is not set"

**–ü—Ä–∏—á–∏–Ω–∞**:
Docker Compose –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞–ª –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ DATABASE_URL:
```yaml
DATABASE_URL=${DATABASE_URL:-postgresql://uk_bot:${POSTGRES_PASSWORD:-uk_bot_password}@postgres:5432/uk_management}
```

–ö–æ–≥–¥–∞ –ø–∞—Ä–æ–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç `Inf@$afe`, Docker –ø—ã—Ç–∞–µ—Ç—Å—è —Ä–∞–∑–æ–±—Ä–∞—Ç—å `$afe` –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é.

**–†–µ—à–µ–Ω–∏–µ**:
–£–±—Ä–∞–ª–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —Ç–µ–ø–µ—Ä—å DATABASE_URL –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ—Ä–µ—Ç—Å—è –∏–∑ .env:
```yaml
DATABASE_URL=${DATABASE_URL}
```

### 2. ‚ö†Ô∏è "version attribute is obsolete"

**–ü—Ä–∏—á–∏–Ω–∞**:
–ê—Ç—Ä–∏–±—É—Ç `version: '3.8'` —É—Å—Ç–∞—Ä–µ–ª –≤ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö Docker Compose.

**–†–µ—à–µ–Ω–∏–µ**:
–£–¥–∞–ª–µ–Ω –∞—Ç—Ä–∏–±—É—Ç `version` –∏–∑ –≤—Å–µ—Ö docker-compose —Ñ–∞–π–ª–æ–≤:
- `docker-compose.unified.yml`
- `docker-compose.prod.unified.yml`
- `docker-compose.dev.yml`
- `docker-compose.prod.yml`

---

## ‚úÖ –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:

1. **docker-compose.unified.yml**
   - –£–±—Ä–∞–Ω—ã –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `${POSTGRES_PASSWORD}` –∏–∑ DATABASE_URL
   - DATABASE_URL —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑ .env
   - ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–æ–≤–µ—Ä–µ–Ω

2. **docker-compose.prod.unified.yml**
   - –¢–µ –∂–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è production
   - ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–æ–≤–µ—Ä–µ–Ω

3. **docker-compose.dev.yml**
   - –£–¥–∞–ª–µ–Ω –∞—Ç—Ä–∏–±—É—Ç `version: '3.8'`

4. **docker-compose.prod.yml**
   - –£–¥–∞–ª–µ–Ω –∞—Ç—Ä–∏–±—É—Ç `version: '3.8'`

5. **.env.unified.example**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ URL-encoding –¥–ª—è –ø–∞—Ä–æ–ª–µ–π —Å–æ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–∞–º–∏
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è DATABASE_URL

6. **SERVER_SETUP_GUIDE.md** (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
   - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å–æ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–∞–º–∏ –≤ –ø–∞—Ä–æ–ª—è—Ö
   - Checklist –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
   - –°–µ–∫—Ü–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º

---

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞

### –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ .env —Ñ–∞–π–ª–∞:

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä–æ–ª—å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
```bash
# .env
POSTGRES_PASSWORD=MySecurePassword123
DATABASE_URL=postgresql://uk_bot:MySecurePassword123@postgres:5432/uk_management
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ü–∞—Ä–æ–ª—å —Å–æ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–∞–º–∏ (—Ç—Ä–µ–±—É–µ—Ç URL-encoding)**
```bash
# –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å Inf@$afe, —Ç–æ:
POSTGRES_PASSWORD=Inf@$afe
DATABASE_URL=postgresql://uk_bot:Inf%40%24afe@postgres:5432/uk_management
```

URL-encoding —Ç–∞–±–ª–∏—Ü–∞:
- `@` ‚Üí `%40`
- `$` ‚Üí `%24`
- `#` ‚Üí `%23`
- `:` ‚Üí `%3A`
- `/` ‚Üí `%2F`

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π .env –¥–ª—è –∑–∞–ø—É—Å–∫–∞:

```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
BOT_TOKEN=your_bot_token_from_botfather
POSTGRES_PASSWORD=YourSecurePassword123
DATABASE_URL=postgresql://uk_bot:YourSecurePassword123@postgres:5432/uk_management

# –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
POSTGRES_DB=uk_management
POSTGRES_USER=uk_bot
REDIS_URL=redis://redis:6379/0
MEDIA_REDIS_URL=redis://redis:6379/1
LOG_LEVEL=INFO
DEBUG=false
```

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞:
```bash
docker-compose -f docker-compose.unified.yml config
```
‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ - —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–æ—Å–ª–µ git pull:
```bash
cd ~/Infrasafe_bot
git pull
cp .env.unified.example .env
nano .env  # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å BOT_TOKEN –∏ –ø–∞—Ä–æ–ª–∏
make start
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞:
```bash
# –í—Å–µ 5 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å Running
docker ps

# Healthcheck –¥–æ–ª–∂–µ–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç—å
curl http://localhost:8009/api/v1/health
```

---

## üîí Security Notes

1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ .env —Ñ–∞–π–ª—ã** - –æ–Ω–∏ –≤ .gitignore
2. **–ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –¥–ª—è production** - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã
3. **–ó–∞–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç—ã –ë–î –≤ production** - –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ `ports:` –≤ docker-compose
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏** - –º–∏–Ω–∏–º—É–º 12 —Å–∏–º–≤–æ–ª–æ–≤
5. **–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–π—Ç–µ –ø—Ä–æ—Å—Ç—ã–µ –ø–∞—Ä–æ–ª–∏ –±–µ–∑ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤** - –º–µ–Ω—å—à–µ –ø—Ä–æ–±–ª–µ–º —Å escaping

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞–ª–∏—Å—å:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker logs uk-postgres`, `docker logs uk-bot`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env: `cat .env | grep -v "^#" | grep -v "^$"`
3. –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞: `make clean && make start`

–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: **SERVER_SETUP_GUIDE.md**

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ Ready for deployment
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–æ–≤–µ—Ä–µ–Ω
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: ‚úÖ SERVER_SETUP_GUIDE.md —Å–æ–∑–¥–∞–Ω
