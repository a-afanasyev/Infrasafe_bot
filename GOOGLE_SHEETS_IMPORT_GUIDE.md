# üìä –†–£–ö–û–í–û–î–°–¢–í–û –ü–û –ò–ú–ü–û–†–¢–£ –í GOOGLE SHEETS

## üéØ –û–±–∑–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–∫–∞–∂–µ—Ç –∫–∞–∫ –∑–∞–≥—Ä—É–∑–∏—Ç—å CSV —Ñ–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏ –∑–∞—è–≤–æ–∫ –≤ Google Sheets —Ç–∞–±–ª–∏—Ü—É.

## üìã –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ Google Sheets —Ç–∞–±–ª–∏—Ü—ã

### 1.1 –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É
1. –û—Ç–∫—Ä–æ–π—Ç–µ [Google Sheets](https://sheets.google.com)
2. –ù–∞–∂–º–∏—Ç–µ **"+"** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã
3. –ù–∞–∑–æ–≤–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É: **"UK Management - –ó–∞—è–≤–∫–∏"**

### 1.2 –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ª–∏—Å—Ç–æ–≤
–°–æ–∑–¥–∞–π—Ç–µ –¥–≤–∞ –ª–∏—Å—Ç–∞:

**–õ–∏—Å—Ç 1: "–ó–∞—è–≤–∫–∏"**
```
A1: ID –∑–∞—è–≤–∫–∏
B1: –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
C1: –°—Ç–∞—Ç—É—Å
D1: –ö–∞—Ç–µ–≥–æ—Ä–∏—è
E1: –ê–¥—Ä–µ—Å
F1: –û–ø–∏—Å–∞–Ω–∏–µ
G1: –°—Ä–æ—á–Ω–æ—Å—Ç—å
H1: –ó–∞—è–≤–∏—Ç–µ–ª—å ID
I1: –ó–∞—è–≤–∏—Ç–µ–ª—å –∏–º—è
J1: –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å ID
K1: –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –∏–º—è
L1: –î–∞—Ç–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
M1: –î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
N1: –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
O1: –§–æ—Ç–æ —Å—Å—ã–ª–∫–∏
P1: –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
Q1: –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
```

**–õ–∏—Å—Ç 2: "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"**
```
A1: –ú–µ—Ç—Ä–∏–∫–∞
B1: –ó–Ω–∞—á–µ–Ω–∏–µ
C1: –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```

## üì§ –®–∞–≥ 2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ CSV —Ñ–∞–π–ª–∞

### 2.1 –°–æ–∑–¥–∞–π—Ç–µ CSV —Ñ–∞–π–ª
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤—ã–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:

```bash
cd /path/to/your/project
source uk_management_bot/venv/bin/activate
python demo_data_export.py
```

### 2.2 –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–∞–π–ª `demo_export.csv` —Å–æ–∑–¥–∞–Ω –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ.

## üîÑ –®–∞–≥ 3: –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

### 3.1 –†—É—á–Ω–æ–π –∏–º–ø–æ—Ä—Ç (–ø–µ—Ä–≤—ã–π —Ä–∞–∑)

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ –º–µ–Ω—é Google Sheets
1. –û—Ç–∫—Ä–æ–π—Ç–µ Google Sheets —Ç–∞–±–ª–∏—Ü—É
2. –í—ã–±–µ—Ä–∏—Ç–µ –ª–∏—Å—Ç "–ó–∞—è–≤–∫–∏"
3. –ù–∞–∂–º–∏—Ç–µ **–§–∞–π–ª** ‚Üí **–ò–º–ø–æ—Ä—Ç**
4. –í—ã–±–µ—Ä–∏—Ç–µ **"–ó–∞–≥—Ä—É–∑–∏—Ç—å"**
5. –ù–∞–π–¥–∏—Ç–µ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à `demo_export.csv` —Ñ–∞–π–ª
6. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∏–º–ø–æ—Ä—Ç–∞:
   - **–ú–µ—Å—Ç–æ –∏–º–ø–æ—Ä—Ç–∞:** "–ó–∞–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ"
   - **–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å:** "–ó–∞–ø—è—Ç–∞—è"
   - **–ö–æ–¥–∏—Ä–æ–≤–∫–∞:** "UTF-8"
7. –ù–∞–∂–º–∏—Ç–µ **"–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ"**

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
1. –û—Ç–∫—Ä–æ–π—Ç–µ Google Sheets —Ç–∞–±–ª–∏—Ü—É
2. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ `demo_export.csv` —Ñ–∞–π–ª –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä
3. Google Sheets –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –∏–º–ø–æ—Ä—Ç
4. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ

### 3.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–∞
–ü–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- ‚úÖ –í—Å–µ –∫–æ–ª–æ–Ω–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –î–∞–Ω–Ω—ã–µ —á–∏—Ç–∞–µ–º—ã (–Ω–µ –∏–µ—Ä–æ–≥–ª–∏—Ñ—ã)
- ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞—è–≤–æ–∫
- ‚úÖ –ó–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–∞ –º–µ—Å—Ç–µ

## ü§ñ –®–∞–≥ 4: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞

### 4.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Apps Script

#### –°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:
1. –í Google Sheets –Ω–∞–∂–º–∏—Ç–µ **–†–∞—Å—à–∏—Ä–µ–Ω–∏—è** ‚Üí **Apps Script**
2. –ù–∞–∑–æ–≤–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç: **"UK Data Import"**

#### –í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥:

```javascript
function importCSVFromURL(retryCount = 0) {
  const MAX_RETRIES = 3;
  const RETRY_DELAY_MS = 1000; // –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ 1 —Å–µ–∫—É–Ω–¥–∞

  // URL –≤–∞—à–µ–≥–æ CSV —Ñ–∞–π–ª–∞ (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π)
  const csvUrl = 'https://your-domain.com/data/requests_export.csv';

  try {
    // ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–æ—Ç Google Sheets API –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º
    checkAPIQuota();

    // –ü–æ–ª—É—á–∞–µ–º CSV –¥–∞–Ω–Ω—ã–µ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
    const response = UrlFetchApp.fetch(csvUrl, {
      muteHttpExceptions: true,
      validateHttpsCertificates: true,
      followRedirects: true,
      timeout: 30 // —Ç–∞–π–º–∞—É—Ç 30 —Å–µ–∫—É–Ω–¥
    });

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞
    const statusCode = response.getResponseCode();
    if (statusCode !== 200) {
      throw new Error(`HTTP Error: ${statusCode}`);
    }

    const csvContent = response.getContentText();

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø—É—Å—Ç—ã–µ
    if (!csvContent || csvContent.trim().length === 0) {
      throw new Error('CSV file is empty');
    }

    // –ü–∞—Ä—Å–∏–º CSV
    const csvData = Utilities.parseCsv(csvContent);

    if (csvData.length === 0) {
      throw new Error('No data in CSV file');
    }

    // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –ª–∏—Å—Ç
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('–ó–∞—è–≤–∫–∏');

    if (!sheet) {
      throw new Error('Sheet "–ó–∞—è–≤–∫–∏" not found');
    }

    // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ (–∫—Ä–æ–º–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤)
    const lastRow = sheet.getLastRow();
    if (lastRow > 1) {
      sheet.getRange(2, 1, lastRow - 1, sheet.getLastColumn()).clear();
    }

    // ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û: –ë–∞—Ç—á–∏–Ω–≥ –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ (Google —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç < 10,000 —è—á–µ–µ–∫ –∑–∞ –∑–∞–ø—Ä–æ—Å)
    if (csvData.length > 1) {
      const BATCH_SIZE = 1000; // –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞
      const dataRows = csvData.slice(1);

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
      PropertiesService.getScriptProperties().setProperty('importStartTime', new Date().toISOString());

      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –±–∞—Ç—á–∞–º–∏
      for (let i = 0; i < dataRows.length; i += BATCH_SIZE) {
        const batch = dataRows.slice(i, Math.min(i + BATCH_SIZE, dataRows.length));
        sheet.getRange(i + 2, 1, batch.length, csvData[0].length).setValues(batch);

        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è rate limiting
        if (i + BATCH_SIZE < dataRows.length) {
          Utilities.sleep(100); // 100ms
          console.log(`‚è≥ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${i + batch.length}/${dataRows.length} —Å—Ç—Ä–æ–∫...`);
        }
      }
      console.log(`‚úÖ –í—Å–µ ${dataRows.length} —Å—Ç—Ä–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã`);
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    updateStatistics(sheet, csvData.length - 1);

    // –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—Ö
    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã: ' + (csvData.length - 1) + ' –∑–∞—è–≤–æ–∫');

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
    PropertiesService.getScriptProperties().setProperty('importErrorCount', '0');

    return true;

  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ (–ø–æ–ø—ã—Ç–∫–∞ ' + (retryCount + 1) + '/' + MAX_RETRIES + '): ' + error.toString());

    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
    const properties = PropertiesService.getScriptProperties();
    const errorCount = parseInt(properties.getProperty('importErrorCount') || '0') + 1;
    properties.setProperty('importErrorCount', errorCount.toString());
    properties.setProperty('lastImportError', error.toString());
    properties.setProperty('lastImportErrorTime', new Date().toISOString());

    // –ï—Å–ª–∏ –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫, –ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑
    if (retryCount < MAX_RETRIES) {
      // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —Å jitter –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è thundering herd
      const baseDelay = RETRY_DELAY_MS * Math.pow(2, retryCount);
      const jitter = Math.random() * 1000; // 0-1000ms —Å–ª—É—á–∞–π–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏
      const delay = baseDelay + jitter;
      console.log('‚è≥ –ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ ' + (delay / 1000).toFixed(2) + ' —Å–µ–∫—É–Ω–¥...');
      Utilities.sleep(delay);

      return importCSVFromURL(retryCount + 1);
    }

    // –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    if (errorCount >= 5) {
      sendErrorNotification(error.toString(), errorCount);
    }

    return false;
  }
}

// ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û: –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Telegram –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
function validateTelegramConfig() {
  const TELEGRAM_BOT_TOKEN = PropertiesService.getScriptProperties().getProperty('TELEGRAM_BOT_TOKEN');
  const TELEGRAM_CHAT_ID = PropertiesService.getScriptProperties().getProperty('TELEGRAM_CHAT_ID');

  if (!TELEGRAM_BOT_TOKEN || !TELEGRAM_CHAT_ID) {
    throw new Error('Telegram credentials not configured. Please set TELEGRAM_BOT_TOKEN and TELEGRAM_CHAT_ID.');
  }

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å: —á–∏—Å–ª–æ:35—Å–∏–º–≤–æ–ª–æ–≤)
  if (!/^\d+:[A-Za-z0-9_-]{35}$/.test(TELEGRAM_BOT_TOKEN)) {
    throw new Error('Invalid Telegram bot token format');
  }

  return { TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID };
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö
function sendErrorNotification(errorMessage, errorCount) {
  try {
    // –ü–æ–ª—É—á–∞–µ–º –∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ–º Telegram credentials
    const { TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID } = validateTelegramConfig();

    const message = `üö® Google Sheets Import Error\n\n` +
                   `–û—à–∏–±–æ–∫ –ø–æ–¥—Ä—è–¥: ${errorCount}\n` +
                   `–ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞: ${errorMessage}\n` +
                   `–í—Ä–µ–º—è: ${new Date().toLocaleString('ru-RU')}`;

    const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;

    UrlFetchApp.fetch(url, {
      method: 'post',
      contentType: 'application/json',
      payload: JSON.stringify({
        chat_id: TELEGRAM_CHAT_ID,
        text: message,
        parse_mode: 'HTML'
      })
    });

    console.log('üì® Error notification sent');

  } catch (e) {
    console.error('‚ùå Failed to send notification: ' + e.toString());
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∏–º–ø–æ—Ä—Ç–∞
function getImportStatus() {
  const properties = PropertiesService.getScriptProperties();

  return {
    errorCount: parseInt(properties.getProperty('importErrorCount') || '0'),
    lastError: properties.getProperty('lastImportError') || 'None',
    lastErrorTime: properties.getProperty('lastImportErrorTime') || 'Never',
    lastSuccessTime: properties.getProperty('lastSuccessTime') || 'Never'
  };
}

// ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–æ—Ç Google Sheets API
function checkAPIQuota() {
  const properties = PropertiesService.getScriptProperties();
  const requests = parseInt(properties.getProperty('requestCount') || '0');
  const timestamp = parseInt(properties.getProperty('requestTimestamp') || '0');

  const now = Date.now();

  // Google Sheets API –ª–∏–º–∏—Ç: 100 –∑–∞–ø—Ä–æ—Å–æ–≤ / 100 —Å–µ–∫—É–Ω–¥ / –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  if (now - timestamp < 100000) { // 100 —Å–µ–∫—É–Ω–¥
    if (requests >= 100) {
      throw new Error('API quota exceeded. Please wait 100 seconds.');
    }
  } else {
    // –°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞ –∫–∞–∂–¥—ã–µ 100 —Å–µ–∫—É–Ω–¥
    properties.setProperty('requestCount', '0');
    properties.setProperty('requestTimestamp', now.toString());
  }

  // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤
  properties.setProperty('requestCount', (requests + 1).toString());
}

function updateStatistics(sheet, requestCount) {
  const statsSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞');
  const now = new Date();
  const startTime = new Date(PropertiesService.getScriptProperties().getProperty('importStartTime') || now);

  // ‚úÖ –£–õ–£–ß–®–ï–ù–û: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  // –ë–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
  statsSheet.getRange('A2:C2').setValues([['–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫', requestCount, now]]);
  statsSheet.getRange('A3:C3').setValues([['–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ', now.toLocaleString('ru-RU'), now]]);

  // –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
  const importDuration = now - startTime;
  statsSheet.getRange('A4:C4').setValues([['–í—Ä–µ–º—è –∏–º–ø–æ—Ä—Ç–∞ (—Å–µ–∫)', (importDuration / 1000).toFixed(2), now]]);

  // –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏
  const rowsPerSecond = requestCount / (importDuration / 1000);
  statsSheet.getRange('A5:C5').setValues([['–°—Ç—Ä–æ–∫/—Å–µ–∫', rowsPerSecond.toFixed(2), now]]);

  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫
  const properties = PropertiesService.getScriptProperties();
  const errorCount = parseInt(properties.getProperty('importErrorCount') || '0');
  statsSheet.getRange('A6:C6').setValues([['–û—à–∏–±–æ–∫ –ø–æ–¥—Ä—è–¥', errorCount, now]]);

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
  properties.setProperty('lastSuccessTime', now.toISOString());
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
function manualImport() {
  importCSVFromURL();
}
```

### 4.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–∞

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫:
1. –í Apps Script –Ω–∞–∂–º–∏—Ç–µ **"–¢—Ä–∏–≥–≥–µ—Ä—ã"** (—á–∞—Å—ã —Å–ª–µ–≤–∞)
2. –ù–∞–∂–º–∏—Ç–µ **"+ –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä"**
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ:
   - **–í—ã–±–µ—Ä–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é:** `importCSVFromURL`
   - **–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–æ–±—ã—Ç–∏—è:** "–í—Ä–µ–º–µ–Ω–Ω–æ–π —Ç—Ä–∏–≥–≥–µ—Ä"
   - **–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –≤—Ä–µ–º–µ–Ω–∏:** "–ú–∏–Ω—É—Ç—ã"
   - **–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª:** "–ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç"
4. –ù–∞–∂–º–∏—Ç–µ **"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"**

## üìÅ –®–∞–≥ 5: –†–∞–∑–º–µ—â–µ–Ω–∏–µ CSV —Ñ–∞–π–ª–∞

### 5.1 –í–∞—Ä–∏–∞–Ω—Ç A: –í–µ–±-—Å–µ—Ä–≤–µ—Ä
–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä:
1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ `requests_export.csv` –Ω–∞ —Å–µ—Ä–≤–µ—Ä
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ URL
3. –û–±–Ω–æ–≤–∏—Ç–µ `csvUrl` –≤ —Å–∫—Ä–∏–ø—Ç–µ

### 5.2 –í–∞—Ä–∏–∞–Ω—Ç B: Google Drive
1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV —Ñ–∞–π–ª –≤ Google Drive
2. –°–¥–µ–ª–∞–π—Ç–µ —Ñ–∞–π–ª –ø—É–±–ª–∏—á–Ω—ã–º (–ü–ö–ú ‚Üí "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" ‚Üí "–î–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º")
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –∏ –æ–±–Ω–æ–≤–∏—Ç–µ `csvUrl`

### 5.3 –í–∞—Ä–∏–∞–Ω—Ç C: GitHub/GitLab
1. –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV —Ñ–∞–π–ª
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ raw URL —Ñ–∞–π–ª–∞

## üîß –®–∞–≥ 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º

### 6.1 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã–≥—Ä—É–∑–∫–∞
–î–æ–±–∞–≤—å—Ç–µ –≤ –≤–∞—à –±–æ—Ç –∫–æ–º–∞–Ω–¥—É –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏:

```python
# –í handlers/admin.py –¥–æ–±–∞–≤—å—Ç–µ:
@router.message(Command("export_data"))
async def export_data_command(message: Message):
    """–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ CSV"""
    try:
        # –°–æ–∑–¥–∞–µ–º –≤—ã–≥—Ä—É–∑–∫—É
        sync = SimpleSheetsSync("", "data/requests_export.csv")
        
        # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã
        db = next(get_db())
        requests = db.query(Request).all()
        
        # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        export_data = []
        for request in requests:
            # ... –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö ...
            export_data.append(request_data)
        
        # –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º
        success = await sync.export_requests_to_csv(export_data)
        
        if success:
            await message.answer("‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ CSV")
        else:
            await message.answer("‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö")
            
    # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ —à–∏—Ä–æ–∫–æ–≥–æ Exception
    except (ValueError, TypeError) as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ: {e}")
        await message.answer(f"‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö: {str(e)}")
    except IOError as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ CSV —Ñ–∞–π–ª–∞: {e}")
        await message.answer(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–∞: {str(e)}")
    except Exception as e:
        logger.exception(f"–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ: {e}")
        await message.answer(f"‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {str(e)}")
```

### 6.2 –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≤—ã–≥—Ä—É–∑–∫—É:

```python
# –í main.py –¥–æ–±–∞–≤—å—Ç–µ:
import asyncio
from apscheduler import AsyncScheduler
from apscheduler.triggers.interval import IntervalTrigger
from apscheduler.events import JobExecutionFailed  # ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û: –î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

async def scheduled_export():
    """–ü–ª–∞–Ω–∏—Ä—É–µ–º–∞—è –≤—ã–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"""
    try:
        sync = SimpleSheetsSync("", "data/requests_export.csv")
        # ... –ª–æ–≥–∏–∫–∞ –≤—ã–≥—Ä—É–∑–∫–∏ ...
        logger.info("–ü–ª–∞–Ω–∏—Ä—É–µ–º–∞—è –≤—ã–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
    # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
    except (ValueError, TypeError) as e:
        logger.error(f"–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö: {e}")
    except IOError as e:
        logger.error(f"–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–∞: {e}")
    except Exception as e:
        logger.exception(f"–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø–ª–∞–Ω–∏—Ä—É–µ–º–æ–π –≤—ã–≥—Ä—É–∑–∫–∏: {e}")

async def job_error_handler(event):
    """‚úÖ –î–û–ë–ê–í–õ–ï–ù–û: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –¥–ª—è APScheduler jobs"""
    logger.error(f"Job {event.job_id} failed: {event.exception}")
    # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –ø—Ä–∏ –æ—à–∏–±–∫–µ
    try:
        from uk_management_bot.services.notification_service import NotificationService
        notification = NotificationService()
        await notification.notify_admins(
            f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞\nJob: {event.job_id}\n–û—à–∏–±–∫–∞: {str(event.exception)}"
        )
    except Exception as e:
        logger.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ: {e}")

async def main():
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Å context manager
    async with AsyncScheduler() as scheduler:
        # ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û: –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –æ—à–∏–±–æ–∫
        scheduler.subscribe(job_error_handler, {JobExecutionFailed})

        # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)
        await scheduler.add_schedule(
            scheduled_export,
            IntervalTrigger(minutes=30),
            id="sheets_export_job"
        )

        # –ó–∞–ø—É—Å–∫–∞–µ–º –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
        await scheduler.start_in_background()

        # –í–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        # ...

# –ó–∞–ø—É—Å–∫
asyncio.run(main())
```

## üìä –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 7.1 –¢–µ—Å—Ç–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ä—É—á–Ω–æ–π –∏–º–ø–æ—Ä—Ç –≤ Apps Script
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø–æ—è–≤–∏–ª–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å

### 7.2 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ Apps Script
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π—Ç–µ —Ä–∞–∑–º–µ—Ä CSV —Ñ–∞–π–ª–∞

## üõ†Ô∏è –®–∞–≥ 8: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã (Production-ready)

### 8.1 Circuit Breaker –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç API –ª–∏–º–∏—Ç–æ–≤

Circuit Breaker –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã–µ —Å–±–æ–∏ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å Google Sheets API:

```python
from uk_management_bot.utils.sheets_utils import CircuitBreaker

# –°–æ–∑–¥–∞–µ–º Circuit Breaker
circuit_breaker = CircuitBreaker(
    failure_threshold=5,      # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –¥–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    recovery_timeout=60       # –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º
)

async def safe_sheets_sync(data):
    """–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Circuit Breaker"""
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏
    if not circuit_breaker.is_closed():
        logger.warning("Circuit Breaker is OPEN, skipping sync")
        return False

    try:
        # –í—ã–ø–æ–ª–Ω—è–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
        success = await sheets_service.sync_data(data)

        if success:
            circuit_breaker.on_success()
        else:
            circuit_breaker.on_error()

        return success

    except Exception as e:
        circuit_breaker.on_error()
        logger.error(f"Sync error: {e}")
        return False

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ Circuit Breaker
status = circuit_breaker.get_state()
print(f"State: {status['state']}, Failures: {status['failure_count']}")
```

### 8.2 Rate Limiter –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤

Rate Limiter —Å–æ–±–ª—é–¥–∞–µ—Ç –ª–∏–º–∏—Ç—ã Google Sheets API (100 –∑–∞–ø—Ä–æ—Å–æ–≤/100 —Å–µ–∫—É–Ω–¥):

```python
from uk_management_bot.utils.sheets_utils import RateLimiter

# –°–æ–∑–¥–∞–µ–º Rate Limiter (60 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É)
rate_limiter = RateLimiter(requests_per_minute=60)

async def sync_with_rate_limit(data):
    """–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —á–∞—Å—Ç–æ—Ç—ã"""
    # –ñ–¥–µ–º, –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç
    await rate_limiter.wait_if_needed()

    # –í—ã–ø–æ–ª–Ω—è–µ–º –æ–ø–µ—Ä–∞—Ü–∏—é
    result = await sheets_service.sync_data(data)

    # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    stats = rate_limiter.get_usage_stats()
    logger.info(f"API Usage: {stats['current_requests']}/{stats['requests_per_minute']}")

    return result
```

### 8.3 –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –æ—á–µ—Ä–µ–¥—è–º–∏

SheetsSyncWorker –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å retry –ª–æ–≥–∏–∫–æ–π:

```python
import asyncio
from uk_management_bot.utils.sheets_utils import (
    SheetsSyncWorker,
    CircuitBreaker,
    RateLimiter
)

# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º factory —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
sync_queue, circuit_breaker, rate_limiter = create_sheets_sync_components(
    failure_threshold=5,
    recovery_timeout=60,
    requests_per_minute=60
)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º worker
worker = SheetsSyncWorker(
    sheets_service=sheets_service,
    queue=sync_queue,
    circuit_breaker=circuit_breaker,
    rate_limiter=rate_limiter
)

# –ó–∞–ø—É—Å–∫–∞–µ–º worker –≤ —Ñ–æ–Ω–µ
asyncio.create_task(worker.start())

# –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥—å
from dataclasses import dataclass

@dataclass
class SyncTask:
    request_id: str
    task_type: str  # "create" –∏–ª–∏ "update"
    data: dict
    retry_count: int = 0

# –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
task = SyncTask(
    request_id="250918-001",
    task_type="create",
    data={"title": "–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞", "status": "pending"}
)

# –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å
await sync_queue.put(task)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ worker
status = worker.get_status()
print(f"Worker: {status['running']}")
print(f"Circuit Breaker: {status['circuit_breaker']['state']}")
print(f"Rate Limiter: {status['rate_limiter']['usage_percentage']}%")
```

### 8.4 Factory —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞

```python
# ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û: Factory —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
from typing import Tuple
from uk_management_bot.utils.sheets_utils import (
    CircuitBreaker,
    RateLimiter,
    SheetsSyncWorker
)

def create_sheets_sync_components(
    failure_threshold: int = 5,
    recovery_timeout: int = 60,
    requests_per_minute: int = 60
) -> Tuple[asyncio.Queue, CircuitBreaker, RateLimiter]:
    """
    Factory —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å Google Sheets.

    Args:
        failure_threshold: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –¥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è Circuit Breaker
        recovery_timeout: –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º (—Å–µ–∫—É–Ω–¥—ã)
        requests_per_minute: –õ–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É

    Returns:
        –ö–æ—Ä—Ç–µ–∂: (queue, circuit_breaker, rate_limiter)
    """
    sync_queue = asyncio.Queue()
    circuit_breaker = CircuitBreaker(
        failure_threshold=failure_threshold,
        recovery_timeout=recovery_timeout
    )
    rate_limiter = RateLimiter(requests_per_minute=requests_per_minute)

    return sync_queue, circuit_breaker, rate_limiter
```

### 8.5 –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (Best Practice)

```python
# –í –≤–∞—à–µ–º —Å–µ—Ä–≤–∏—Å–µ
class RequestService:
    def __init__(self):
        # ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º factory —Ñ—É–Ω–∫—Ü–∏—é –≤–º–µ—Å—Ç–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
        self.sync_queue, self.circuit_breaker, self.rate_limiter = create_sheets_sync_components(
            failure_threshold=5,
            recovery_timeout=60,
            requests_per_minute=60
        )

        # –ó–∞–ø—É—Å–∫–∞–µ–º worker
        self.worker = SheetsSyncWorker(
            sheets_service=sheets_service,
            queue=self.sync_queue,
            circuit_breaker=self.circuit_breaker,
            rate_limiter=self.rate_limiter
        )
        asyncio.create_task(self.worker.start())

    async def create_request(self, data):
        """–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π"""
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î
        request = await self.db.create_request(data)

        # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        task = SyncTask(
            request_id=request.request_number,
            task_type="create",
            data=request.to_dict()
        )
        await self.sync_queue.put(task)

        return request

    async def get_sync_status(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏"""
        return self.worker.get_status()
```

## üõ†Ô∏è –®–∞–≥ 9: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 9.1 –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
- –î–æ–±–∞–≤—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –∫ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É—Å–ª–æ–≤–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–¥–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

### 9.2 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Apps Script:

```javascript
function sendNotification(message) {
  // –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –∏–ª–∏ email
  // –†–µ–∞–ª–∏–∑—É–π—Ç–µ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
}
```

## üö® –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–¥–∏—Ä–æ–≤–∫–∞
**–°–∏–º–ø—Ç–æ–º:** –ò–µ—Ä–æ–≥–ª–∏—Ñ—ã –≤ —Ç–∞–±–ª–∏—Ü–µ
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ CSV –≤ UTF-8

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
**–°–∏–º–ø—Ç–æ–º:** –î–∞–Ω–Ω—ã–µ –Ω–µ –º–µ–Ω—è—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –≤ Apps Script (–ß–∞—Å—ã ‚Üí –¢—Ä–∏–≥–≥–µ—Ä—ã)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ CSV —Ñ–∞–π–ª—É
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (Executions)
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `getImportStatus()` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞
**–°–∏–º–ø—Ç–æ–º:** "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω"
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL CSV —Ñ–∞–π–ª–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–∞–π–ª –ø—É–±–ª–∏—á–Ω–æ –¥–æ—Å—Ç—É–ø–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞
**–°–∏–º–ø—Ç–æ–º:** –ú–Ω–æ–≥–æ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Circuit Breaker —Å—Ç–∞—Ç—É—Å
2. –£–≤–µ–ª–∏—á—å—Ç–µ `recovery_timeout` –≤ Circuit Breaker
3. –£–º–µ–Ω—å—à–∏—Ç–µ `requests_per_minute` –≤ Rate Limiter
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–≤–æ—Ç—ã Google Sheets API

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ Apps Script
```javascript
// –ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
function diagnostics() {
  const status = getImportStatus();
  console.log('üìä Import Status:');
  console.log('Error Count: ' + status.errorCount);
  console.log('Last Error: ' + status.lastError);
  console.log('Last Error Time: ' + status.lastErrorTime);
  console.log('Last Success: ' + status.lastSuccessTime);
}
```

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- [ ] Google Sheets —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞
- [ ] CSV —Ñ–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏ –≥–æ—Ç–æ–≤
- [ ] –ü–µ—Ä–≤—ã–π –∏–º–ø–æ—Ä—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
- [ ] Apps Script –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –¢—Ä–∏–≥–≥–µ—Ä—ã —Å–æ–∑–¥–∞–Ω—ã

### Production-ready –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- [ ] Circuit Breaker –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
- [ ] Rate Limiter –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] SheetsSyncWorker –∑–∞–ø—É—â–µ–Ω
- [ ] APScheduler v4.x –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Retry –ª–æ–≥–∏–∫–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Telegram Bot Token –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- [ ] –õ–æ–≥–∏ Apps Script –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- [ ] `getImportStatus()` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Circuit Breaker –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—Å—è
- [ ] Rate Limiter –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è

## üéâ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —É –≤–∞—Å –±—É–¥–µ—Ç:

### –ë–∞–∑–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ ‚úÖ
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- ‚úÖ –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑ API

### Production-ready –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ üöÄ
- ‚úÖ Circuit Breaker –∑–∞—â–∏—Ç–∞ –æ—Ç API –ª–∏–º–∏—Ç–æ–≤
- ‚úÖ Rate Limiter –∫–æ–Ω—Ç—Ä–æ–ª—å —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –æ—á–µ—Ä–µ–¥—è–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ retry —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
- ‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- ‚úÖ APScheduler v4.x —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º

**–î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –≤ Google Sheets —Å enterprise-grade –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é!** üöÄ

---

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –í–µ—Ä—Å–∏—è 2.0 - Best Practices Update (17.10.2025)

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (P0):**
1. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–æ—Ç Google Sheets API** (—Å—Ç—Ä–æ–∫–∞ 108, 257-278)
   - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `checkAPIQuota()` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ (100 –∑–∞–ø—Ä–æ—Å–æ–≤/100 —Å–µ–∫—É–Ω–¥)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞ –∫–∞–∂–¥—ã–µ 100 —Å–µ–∫—É–Ω–¥
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º API –∑–∞–ø—Ä–æ—Å–æ–º

2. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω jitter –≤ exponential backoff** (—Å—Ç—Ä–æ–∫–∏ 179-184)
   - –°–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ 0-1000ms –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è thundering herd problem
   - –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞: `baseDelay + random(0-1000ms)`
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ—á–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–¥–µ—Ä–∂–∫–∏

**–í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (P1):**
3. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è Telegram Bot Token** (—Å—Ç—Ä–æ–∫–∏ 198-213)
   - –§—É–Ω–∫—Ü–∏—è `validateTelegramConfig()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞
   - Regex –ø—Ä–æ–≤–µ—Ä–∫–∞: `^\d+:[A-Za-z0-9_-]{35}$`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è TELEGRAM_BOT_TOKEN –∏ TELEGRAM_CHAT_ID

4. ‚úÖ **–°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤ Python –∫–æ–¥–µ** (—Å—Ç—Ä–æ–∫–∏ 392-401, 420-425)
   - –ó–∞–º–µ–Ω–µ–Ω—ã —à–∏—Ä–æ–∫–∏–µ `except Exception` –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –æ—Ç–¥–µ–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è ValueError, TypeError, IOError
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `logger.exception()` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ traceback

5. ‚úÖ **APScheduler error handler** (—Å—Ç—Ä–æ–∫–∏ 412, 427-444)
   - –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `JobExecutionFailed` —Å–æ–±—ã—Ç–∏—è
   - –§—É–Ω–∫—Ü–∏—è `job_error_handler()` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ jobs
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –ø—Ä–∏ —Å–±–æ—è—Ö
   - –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è: `scheduler.subscribe(job_error_handler, {JobExecutionFailed})`

**–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (P2):**
6. ‚úÖ **–ë–∞—Ç—á–∏–Ω–≥ –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤** (—Å—Ç—Ä–æ–∫–∏ 151-171)
   - –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 1000 —Å—Ç—Ä–æ–∫ (< 10,000 —è—á–µ–µ–∫ Google —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è)
   - –ó–∞–¥–µ—Ä–∂–∫–∞ 100ms –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏ –¥–ª—è rate limiting
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

7. ‚úÖ **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏** (—Å—Ç—Ä–æ–∫–∏ 280-305)
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –≤—Ä–µ–º—è –∏–º–ø–æ—Ä—Ç–∞, —Å—Ç—Ä–æ–∫/—Å–µ–∫
   - –°—á–µ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –ø–æ–¥—Ä—è–¥ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞ –∏–º–ø–æ—Ä—Ç–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

8. ‚úÖ **Factory —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** (—Å—Ç—Ä–æ–∫–∏ 597-632, 641-645, 556-569)
   - –§—É–Ω–∫—Ü–∏—è `create_sheets_sync_components()` —Å–æ–∑–¥–∞–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
   - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Circuit Breaker, Rate Limiter, Queue
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –≤ —Ç—Ä–µ—Ö –º–µ—Å—Ç–∞—Ö –≤–º–µ—Å—Ç–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
   - –¢–∏–ø–∏–∑–∞—Ü–∏—è —Å `Tuple` –¥–ª—è type hints

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏:**
- Google Apps Script Best Practices Documentation
- APScheduler 4.x Official Documentation
- Google Sheets API v4 Quotas & Limits
- Context7 Library Documentation

**–°–ª–µ–¥—É—é—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–≤–æ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π Circuit Breaker –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤
- –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 17 –æ–∫—Ç—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è –≥–∞–π–¥–∞:** 2.0 (–æ–±–Ω–æ–≤–ª–µ–Ω–æ —Å Context7 + sheets_utils.py)
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** APScheduler 4.x, Google Apps Script, Circuit Breaker, Rate Limiter

